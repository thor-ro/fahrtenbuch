var Qe=Object.defineProperty;var Xe=(t,r,a)=>r in t?Qe(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var R=(t,r,a)=>(Xe(t,typeof r!="symbol"?r+"":r,a),a),Gt=(t,r,a)=>{if(!r.has(t))throw TypeError("Cannot "+a)},v=(t,r,a)=>(Gt(t,r,"read from private field"),a?a.call(t):r.get(t)),tt=(t,r,a,s)=>(Gt(t,r,"write to private field"),s?s.call(t,a):r.set(t,a),a),mt=(t,r,a)=>(Gt(t,r,"access private method"),a);function lt(t,r,a,s,m,l){return{tag:t,key:r,attrs:a,children:s,text:m,dom:l,domSize:void 0,state:void 0,events:void 0,instance:void 0}}lt.normalize=function(t){return Array.isArray(t)?lt("[",void 0,void 0,lt.normalizeChildren(t),void 0,void 0):t==null||typeof t=="boolean"?null:typeof t=="object"?t:lt("#",void 0,void 0,String(t),void 0,void 0)};lt.normalizeChildren=function(t){var r=[];if(t.length){for(var a=t[0]!=null&&t[0].key!=null,s=1;s<t.length;s++)if((t[s]!=null&&t[s].key!=null)!==a)throw new TypeError(a&&(t[s]!=null||typeof t[s]=="boolean")?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.");for(var s=0;s<t.length;s++)r[s]=lt.normalize(t[s])}return r};var nt=lt,he=function(){var t=arguments[this],r=this+1,a;if(t==null?t={}:(typeof t!="object"||t.tag!=null||Array.isArray(t))&&(t={},r=this),arguments.length===r+1)a=arguments[r],Array.isArray(a)||(a=[a]);else for(a=[];r<arguments.length;)a.push(arguments[r++]);return nt("",t.key,t,a)},it={}.hasOwnProperty,$e=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,me={};function pe(t){for(var r in t)if(it.call(t,r))return!1;return!0}function tr(t){for(var r,a="div",s=[],m={};r=$e.exec(t);){var l=r[1],f=r[2];if(l===""&&f!=="")a=f;else if(l==="#")m.id=f;else if(l===".")s.push(f);else if(r[3][0]==="["){var p=r[6];p&&(p=p.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?s.push(p):m[r[4]]=p===""?p:p||!0}}return s.length>0&&(m.className=s.join(" ")),me[t]={tag:a,attrs:m}}function er(t,r){var a=r.attrs,s=it.call(a,"class"),m=s?a.class:a.className;if(r.tag=t.tag,r.attrs={},!pe(t.attrs)&&!pe(a)){var l={};for(var f in a)it.call(a,f)&&(l[f]=a[f]);a=l}for(var f in t.attrs)it.call(t.attrs,f)&&f!=="className"&&!it.call(a,f)&&(a[f]=t.attrs[f]);(m!=null||t.attrs.className!=null)&&(a.className=m!=null?t.attrs.className!=null?String(t.attrs.className)+" "+String(m):m:t.attrs.className!=null?t.attrs.className:null),s&&(a.class=null);for(var f in a)if(it.call(a,f)&&f!=="key"){r.attrs=a;break}return r}function rr(t){if(t==null||typeof t!="string"&&typeof t!="function"&&typeof t.view!="function")throw Error("The selector must be either a string or a component.");var r=he.apply(1,arguments);return typeof t=="string"&&(r.children=nt.normalizeChildren(r.children),t!=="[")?er(me[t]||tr(t),r):(r.tag=t,r)}var Ct=rr,nr=function(t){return t==null&&(t=""),nt("<",void 0,void 0,t,void 0,void 0)},ir=function(){var t=he.apply(0,arguments);return t.tag="[",t.children=nt.normalizeChildren(t.children),t};Ct.trust=nr;Ct.fragment=ir;var vt=Ct,pt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function sr(t,r,a){return a={path:r,exports:{},require:function(s,m){return ar(s,m??a.path)}},t(a,a.exports),a.exports}function ar(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var K=function(t){if(!(this instanceof K))throw new Error("Promise must be called with 'new'.");if(typeof t!="function")throw new TypeError("executor must be a function.");var r=this,a=[],s=[],m=h(a,!0),l=h(s,!1),f=r._instance={resolvers:a,rejectors:s},p=typeof setImmediate=="function"?setImmediate:setTimeout;function h(_,E){return function A(T){var b;try{if(E&&T!=null&&(typeof T=="object"||typeof T=="function")&&typeof(b=T.then)=="function"){if(T===r)throw new TypeError("Promise can't be resolved with itself.");y(b.bind(T))}else p(function(){!E&&_.length===0&&console.error("Possible unhandled promise rejection:",T);for(var w=0;w<_.length;w++)_[w](T);a.length=0,s.length=0,f.state=E,f.retry=function(){A(T)}})}catch(w){l(w)}}}function y(_){var E=0;function A(b){return function(w){E++>0||b(w)}}var T=A(l);try{_(A(m),T)}catch(b){T(b)}}y(t)};K.prototype.then=function(t,r){var a=this,s=a._instance;function m(h,y,_,E){y.push(function(A){if(typeof h!="function")_(A);else try{l(h(A))}catch(T){f&&f(T)}}),typeof s.retry=="function"&&E===s.state&&s.retry()}var l,f,p=new K(function(h,y){l=h,f=y});return m(t,s.resolvers,l,!0),m(r,s.rejectors,f,!1),p};K.prototype.catch=function(t){return this.then(null,t)};K.prototype.finally=function(t){return this.then(function(r){return K.resolve(t()).then(function(){return r})},function(r){return K.resolve(t()).then(function(){return K.reject(r)})})};K.resolve=function(t){return t instanceof K?t:new K(function(r){r(t)})};K.reject=function(t){return new K(function(r,a){a(t)})};K.all=function(t){return new K(function(r,a){var s=t.length,m=0,l=[];if(t.length===0)r([]);else for(var f=0;f<t.length;f++)(function(p){function h(y){m++,l[p]=y,m===s&&r(l)}t[p]!=null&&(typeof t[p]=="object"||typeof t[p]=="function")&&typeof t[p].then=="function"?t[p].then(h,a):h(t[p])})(f)})};K.race=function(t){return new K(function(r,a){for(var s=0;s<t.length;s++)t[s].then(r,a)})};var dt=K,de=sr(function(t){typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=dt:window.Promise.prototype.finally||(window.Promise.prototype.finally=dt.prototype.finally),t.exports=window.Promise):typeof pt!="undefined"?(typeof pt.Promise=="undefined"?pt.Promise=dt:pt.Promise.prototype.finally||(pt.Promise.prototype.finally=dt.prototype.finally),t.exports=pt.Promise):t.exports=dt}),or=function(t){var r=t&&t.document,a,s={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function m(n){return n.attrs&&n.attrs.xmlns||s[n.tag]}function l(n,e){if(n.state!==e)throw new Error("'vnode.state' must not be modified.")}function f(n){var e=n.state;try{return this.apply(e,arguments)}finally{l(n,e)}}function p(){try{return r.activeElement}catch(n){return null}}function h(n,e,i,c,u,d,x){for(var j=i;j<c;j++){var g=e[j];g!=null&&y(n,g,u,x,d)}}function y(n,e,i,c,u){var d=e.tag;if(typeof d=="string")switch(e.state={},e.attrs!=null&&Bt(e.attrs,e,i),d){case"#":_(n,e,u);break;case"<":A(n,e,c,u);break;case"[":T(n,e,i,c,u);break;default:b(n,e,i,c,u)}else N(n,e,i,c,u)}function _(n,e,i){e.dom=r.createTextNode(e.children),rt(n,e.dom,i)}var E={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function A(n,e,i,c){var u=e.children.match(/^\s*?<(\w+)/im)||[],d=r.createElement(E[u[1]]||"div");i==="http://www.w3.org/2000/svg"?(d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e.children+"</svg>",d=d.firstChild):d.innerHTML=e.children,e.dom=d.firstChild,e.domSize=d.childNodes.length,e.instance=[];for(var x=r.createDocumentFragment(),j;j=d.firstChild;)e.instance.push(j),x.appendChild(j);rt(n,x,c)}function T(n,e,i,c,u){var d=r.createDocumentFragment();if(e.children!=null){var x=e.children;h(d,x,0,x.length,i,null,c)}e.dom=d.firstChild,e.domSize=d.childNodes.length,rt(n,d,u)}function b(n,e,i,c,u){var d=e.tag,x=e.attrs,j=x&&x.is;c=m(e)||c;var g=c?j?r.createElementNS(c,d,{is:j}):r.createElementNS(c,d):j?r.createElement(d,{is:j}):r.createElement(d);if(e.dom=g,x!=null&&Ke(e,x,c),rt(n,g,u),!ae(e)&&e.children!=null){var D=e.children;h(g,D,0,D.length,i,null,c),e.tag==="select"&&x!=null&&qe(e,x)}}function w(n,e){var i;if(typeof n.tag.view=="function"){if(n.state=Object.create(n.tag),i=n.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(n.state=void 0,i=n.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,n.state=n.tag.prototype!=null&&typeof n.tag.prototype.view=="function"?new n.tag(n):n.tag(n)}if(Bt(n.state,n,e),n.attrs!=null&&Bt(n.attrs,n,e),n.instance=nt.normalize(f.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function N(n,e,i,c,u){w(e,i),e.instance!=null?(y(n,e.instance,i,c,u),e.dom=e.instance.dom,e.domSize=e.dom!=null?e.instance.domSize:0):e.domSize=0}function S(n,e,i,c,u,d){if(!(e===i||e==null&&i==null))if(e==null||e.length===0)h(n,i,0,i.length,c,u,d);else if(i==null||i.length===0)wt(n,e,0,e.length);else{var x=e[0]!=null&&e[0].key!=null,j=i[0]!=null&&i[0].key!=null,g=0,D=0;if(!x)for(;D<e.length&&e[D]==null;)D++;if(!j)for(;g<i.length&&i[g]==null;)g++;if(x!==j)wt(n,e,D,e.length),h(n,i,g,i.length,c,u,d);else if(j){for(var Z=e.length-1,F=i.length-1,kt,Y,H,W,z,Ft;Z>=D&&F>=g&&(W=e[Z],z=i[F],W.key===z.key);)W!==z&&V(n,W,z,c,u,d),z.dom!=null&&(u=z.dom),Z--,F--;for(;Z>=D&&F>=g&&(Y=e[D],H=i[g],Y.key===H.key);)D++,g++,Y!==H&&V(n,Y,H,c,$(e,D,u),d);for(;Z>=D&&F>=g&&!(g===F||Y.key!==z.key||W.key!==H.key);)Ft=$(e,D,u),ut(n,W,Ft),W!==H&&V(n,W,H,c,Ft,d),++g<=--F&&ut(n,Y,u),Y!==z&&V(n,Y,z,c,u,d),z.dom!=null&&(u=z.dom),D++,Z--,W=e[Z],z=i[F],Y=e[D],H=i[g];for(;Z>=D&&F>=g&&W.key===z.key;)W!==z&&V(n,W,z,c,u,d),z.dom!=null&&(u=z.dom),Z--,F--,W=e[Z],z=i[F];if(g>F)wt(n,e,D,Z+1);else if(D>Z)h(n,i,g,F+1,c,u,d);else{var Je=u,ue=F-g+1,xt=new Array(ue),Kt=0,O=0,Ut=2147483647,qt=0,kt,Vt;for(O=0;O<ue;O++)xt[O]=-1;for(O=F;O>=g;O--){kt==null&&(kt=L(e,D,Z+1)),z=i[O];var ht=kt[z.key];ht!=null&&(Ut=ht<Ut?ht:-1,xt[O-g]=ht,W=e[ht],e[ht]=null,W!==z&&V(n,W,z,c,u,d),z.dom!=null&&(u=z.dom),qt++)}if(u=Je,qt!==Z-D+1&&wt(n,e,D,Z+1),qt===0)h(n,i,g,F+1,c,u,d);else if(Ut===-1)for(Vt=G(xt),Kt=Vt.length-1,O=F;O>=g;O--)H=i[O],xt[O-g]===-1?y(n,H,c,d,u):Vt[Kt]===O-g?Kt--:ut(n,H,u),H.dom!=null&&(u=i[O].dom);else for(O=F;O>=g;O--)H=i[O],xt[O-g]===-1&&y(n,H,c,d,u),H.dom!=null&&(u=i[O].dom)}}else{var Ht=e.length<i.length?e.length:i.length;for(g=g<D?g:D;g<Ht;g++)Y=e[g],H=i[g],!(Y===H||Y==null&&H==null)&&(Y==null?y(n,H,c,d,$(e,g+1,u)):H==null?At(n,Y):V(n,Y,H,c,$(e,g+1,u),d));e.length>Ht&&wt(n,e,g,e.length),i.length>Ht&&h(n,i,g,i.length,c,u,d)}}}function V(n,e,i,c,u,d){var x=e.tag,j=i.tag;if(x===j){if(i.state=e.state,i.events=e.events,Ye(i,e))return;if(typeof x=="string")switch(i.attrs!=null&&Ot(i.attrs,i,c),x){case"#":P(e,i);break;case"<":C(n,e,i,d,u);break;case"[":M(n,e,i,c,u,d);break;default:k(e,i,c,d)}else B(n,e,i,c,u,d)}else At(n,e),y(n,i,c,d,u)}function P(n,e){n.children.toString()!==e.children.toString()&&(n.dom.nodeValue=e.children),e.dom=n.dom}function C(n,e,i,c,u){e.children!==i.children?(se(n,e),A(n,i,c,u)):(i.dom=e.dom,i.domSize=e.domSize,i.instance=e.instance)}function M(n,e,i,c,u,d){S(n,e.children,i.children,c,u,d);var x=0,j=i.children;if(i.dom=null,j!=null){for(var g=0;g<j.length;g++){var D=j[g];D!=null&&D.dom!=null&&(i.dom==null&&(i.dom=D.dom),x+=D.domSize||1)}x!==1&&(i.domSize=x)}}function k(n,e,i,c){var u=e.dom=n.dom;c=m(e)||c,e.tag==="textarea"&&e.attrs==null&&(e.attrs={}),Ve(e,n.attrs,e.attrs,c),ae(e)||S(u,n.children,e.children,i,null,c)}function B(n,e,i,c,u,d){if(i.instance=nt.normalize(f.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");Ot(i.state,i,c),i.attrs!=null&&Ot(i.attrs,i,c),i.instance!=null?(e.instance==null?y(n,i.instance,c,d,u):V(n,e.instance,i.instance,c,u,d),i.dom=i.instance.dom,i.domSize=i.instance.domSize):e.instance!=null?(At(n,e.instance),i.dom=void 0,i.domSize=0):(i.dom=e.dom,i.domSize=e.domSize)}function L(n,e,i){for(var c=Object.create(null);e<i;e++){var u=n[e];if(u!=null){var d=u.key;d!=null&&(c[d]=e)}}return c}var I=[];function G(n){for(var e=[0],i=0,c=0,u=0,d=I.length=n.length,u=0;u<d;u++)I[u]=n[u];for(var u=0;u<d;++u)if(n[u]!==-1){var x=e[e.length-1];if(n[x]<n[u]){I[u]=x,e.push(u);continue}for(i=0,c=e.length-1;i<c;){var j=(i>>>1)+(c>>>1)+(i&c&1);n[e[j]]<n[u]?i=j+1:c=j}n[u]<n[e[i]]&&(i>0&&(I[u]=e[i-1]),e[i]=u)}for(i=e.length,c=e[i-1];i-- >0;)e[i]=c,c=I[c];return I.length=0,e}function $(n,e,i){for(;e<n.length;e++)if(n[e]!=null&&n[e].dom!=null)return n[e].dom;return i}function ut(n,e,i){var c=r.createDocumentFragment();ct(n,c,e),rt(n,c,i)}function ct(n,e,i){for(;i.dom!=null&&i.dom.parentNode===n;){if(typeof i.tag!="string"){if(i=i.instance,i!=null)continue}else if(i.tag==="<")for(var c=0;c<i.instance.length;c++)e.appendChild(i.instance[c]);else if(i.tag!=="[")e.appendChild(i.dom);else if(i.children.length===1){if(i=i.children[0],i!=null)continue}else for(var c=0;c<i.children.length;c++){var u=i.children[c];u!=null&&ct(n,e,u)}break}}function rt(n,e,i){i!=null?n.insertBefore(e,i):n.appendChild(e)}function ae(n){if(n.attrs==null||n.attrs.contenteditable==null&&n.attrs.contentEditable==null)return!1;var e=n.children;if(e!=null&&e.length===1&&e[0].tag==="<"){var i=e[0].children;n.dom.innerHTML!==i&&(n.dom.innerHTML=i)}else if(e!=null&&e.length!==0)throw new Error("Child node of a contenteditable must be trusted.");return!0}function wt(n,e,i,c){for(var u=i;u<c;u++){var d=e[u];d!=null&&At(n,d)}}function At(n,e){var i=0,c=e.state,u,d;if(typeof e.tag!="string"&&typeof e.state.onbeforeremove=="function"){var x=f.call(e.state.onbeforeremove,e);x!=null&&typeof x.then=="function"&&(i=1,u=x)}if(e.attrs&&typeof e.attrs.onbeforeremove=="function"){var x=f.call(e.attrs.onbeforeremove,e);x!=null&&typeof x.then=="function"&&(i|=2,d=x)}if(l(e,c),!i)Tt(e),St(n,e);else{if(u!=null){var j=function(){i&1&&(i&=2,i||g())};u.then(j,j)}if(d!=null){var j=function(){i&2&&(i&=1,i||g())};d.then(j,j)}}function g(){l(e,c),Tt(e),St(n,e)}}function se(n,e){for(var i=0;i<e.instance.length;i++)n.removeChild(e.instance[i])}function St(n,e){for(;e.dom!=null&&e.dom.parentNode===n;){if(typeof e.tag!="string"){if(e=e.instance,e!=null)continue}else if(e.tag==="<")se(n,e);else{if(e.tag!=="["&&(n.removeChild(e.dom),!Array.isArray(e.children)))break;if(e.children.length===1){if(e=e.children[0],e!=null)continue}else for(var i=0;i<e.children.length;i++){var c=e.children[i];c!=null&&St(n,c)}}break}}function Tt(n){if(typeof n.tag!="string"&&typeof n.state.onremove=="function"&&f.call(n.state.onremove,n),n.attrs&&typeof n.attrs.onremove=="function"&&f.call(n.attrs.onremove,n),typeof n.tag!="string")n.instance!=null&&Tt(n.instance);else{var e=n.children;if(Array.isArray(e))for(var i=0;i<e.length;i++){var c=e[i];c!=null&&Tt(c)}}}function Ke(n,e,i){n.tag==="input"&&e.type!=null&&n.dom.setAttribute("type",e.type);var c=e!=null&&n.tag==="input"&&e.type==="file";for(var u in e)Rt(n,u,null,e[u],i,c)}function Rt(n,e,i,c,u,d){if(!(e==="key"||e==="is"||c==null||oe(e)||i===c&&!Ge(n,e)&&typeof c!="object"||e==="type"&&n.tag==="input")){if(e[0]==="o"&&e[1]==="n")return fe(n,e,c);if(e.slice(0,6)==="xlink:")n.dom.setAttributeNS("http://www.w3.org/1999/xlink",e.slice(6),c);else if(e==="style")le(n.dom,i,c);else if(ce(n,e,u)){if(e==="value"){if((n.tag==="input"||n.tag==="textarea")&&n.dom.value===""+c&&(d||n.dom===p())||n.tag==="select"&&i!==null&&n.dom.value===""+c||n.tag==="option"&&i!==null&&n.dom.value===""+c)return;if(d&&""+c!=""){console.error("`value` is read-only on file inputs!");return}}n.dom[e]=c}else typeof c=="boolean"?c?n.dom.setAttribute(e,""):n.dom.removeAttribute(e):n.dom.setAttribute(e==="className"?"class":e,c)}}function Ue(n,e,i,c){if(!(e==="key"||e==="is"||i==null||oe(e)))if(e[0]==="o"&&e[1]==="n")fe(n,e,void 0);else if(e==="style")le(n.dom,i,null);else if(ce(n,e,c)&&e!=="className"&&e!=="title"&&!(e==="value"&&(n.tag==="option"||n.tag==="select"&&n.dom.selectedIndex===-1&&n.dom===p()))&&!(n.tag==="input"&&e==="type"))n.dom[e]=null;else{var u=e.indexOf(":");u!==-1&&(e=e.slice(u+1)),i!==!1&&n.dom.removeAttribute(e==="className"?"class":e)}}function qe(n,e){if("value"in e)if(e.value===null)n.dom.selectedIndex!==-1&&(n.dom.value=null);else{var i=""+e.value;(n.dom.value!==i||n.dom.selectedIndex===-1)&&(n.dom.value=i)}"selectedIndex"in e&&Rt(n,"selectedIndex",null,e.selectedIndex,void 0)}function Ve(n,e,i,c){if(e&&e===i&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major"),i!=null){n.tag==="input"&&i.type!=null&&n.dom.setAttribute("type",i.type);var u=n.tag==="input"&&i.type==="file";for(var d in i)Rt(n,d,e&&e[d],i[d],c,u)}var x;if(e!=null)for(var d in e)(x=e[d])!=null&&(i==null||i[d]==null)&&Ue(n,d,x,c)}function Ge(n,e){return e==="value"||e==="checked"||e==="selectedIndex"||e==="selected"&&n.dom===p()||n.tag==="option"&&n.dom.parentNode===r.activeElement}function oe(n){return n==="oninit"||n==="oncreate"||n==="onupdate"||n==="onremove"||n==="onbeforeremove"||n==="onbeforeupdate"}function ce(n,e,i){return i===void 0&&(n.tag.indexOf("-")>-1||n.attrs!=null&&n.attrs.is||e!=="href"&&e!=="list"&&e!=="form"&&e!=="width"&&e!=="height")&&e in n.dom}var We=/[A-Z]/g;function Ze(n){return"-"+n.toLowerCase()}function zt(n){return n[0]==="-"&&n[1]==="-"?n:n==="cssFloat"?"float":n.replace(We,Ze)}function le(n,e,i){if(e!==i)if(i==null)n.style.cssText="";else if(typeof i!="object")n.style.cssText=i;else if(e==null||typeof e!="object"){n.style.cssText="";for(var c in i){var u=i[c];u!=null&&n.style.setProperty(zt(c),String(u))}}else{for(var c in i){var u=i[c];u!=null&&(u=String(u))!==String(e[c])&&n.style.setProperty(zt(c),u)}for(var c in e)e[c]!=null&&i[c]==null&&n.style.removeProperty(zt(c))}}function Pt(){this._=a}Pt.prototype=Object.create(null),Pt.prototype.handleEvent=function(n){var e=this["on"+n.type],i;typeof e=="function"?i=e.call(n.currentTarget,n):typeof e.handleEvent=="function"&&e.handleEvent(n),this._&&n.redraw!==!1&&(0,this._)(),i===!1&&(n.preventDefault(),n.stopPropagation())};function fe(n,e,i){if(n.events!=null){if(n.events._=a,n.events[e]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(n.events[e]==null&&n.dom.addEventListener(e.slice(2),n.events,!1),n.events[e]=i):(n.events[e]!=null&&n.dom.removeEventListener(e.slice(2),n.events,!1),n.events[e]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(n.events=new Pt,n.dom.addEventListener(e.slice(2),n.events,!1),n.events[e]=i)}function Bt(n,e,i){typeof n.oninit=="function"&&f.call(n.oninit,e),typeof n.oncreate=="function"&&i.push(f.bind(n.oncreate,e))}function Ot(n,e,i){typeof n.onupdate=="function"&&i.push(f.bind(n.onupdate,e))}function Ye(n,e){do{if(n.attrs!=null&&typeof n.attrs.onbeforeupdate=="function"){var i=f.call(n.attrs.onbeforeupdate,n,e);if(i!==void 0&&!i)break}if(typeof n.tag!="string"&&typeof n.state.onbeforeupdate=="function"){var i=f.call(n.state.onbeforeupdate,n,e);if(i!==void 0&&!i)break}return!1}while(!1);return n.dom=e.dom,n.domSize=e.domSize,n.instance=e.instance,n.attrs=e.attrs,n.children=e.children,n.text=e.text,!0}var bt;return function(n,e,i){if(!n)throw new TypeError("DOM element being rendered to does not exist.");if(bt!=null&&n.contains(bt))throw new TypeError("Node is currently being rendered to and thus is locked.");var c=a,u=bt,d=[],x=p(),j=n.namespaceURI;bt=n,a=typeof i=="function"?i:void 0;try{n.vnodes==null&&(n.textContent=""),e=nt.normalizeChildren(Array.isArray(e)?e:[e]),S(n,n.vnodes,e,d,null,j==="http://www.w3.org/1999/xhtml"?void 0:j),n.vnodes=e,x!=null&&p()!==x&&typeof x.focus=="function"&&x.focus();for(var g=0;g<d.length;g++)d[g]()}finally{a=c,bt=u}}},ye=or(typeof window!="undefined"?window:null),cr=function(t,r,a){var s=[],m=!1,l=-1;function f(){for(l=0;l<s.length;l+=2)try{t(s[l],nt(s[l+1]),p)}catch(y){a.error(y)}l=-1}function p(){m||(m=!0,r(function(){m=!1,f()}))}p.sync=f;function h(y,_){if(_!=null&&_.view==null&&typeof _!="function")throw new TypeError("m.mount expects a component, not a vnode.");var E=s.indexOf(y);E>=0&&(s.splice(E,2),E<=l&&(l-=2),t(y,[])),_!=null&&(s.push(y,_),t(y,nt(_),p))}return{mount:h,redraw:p}},It=cr(ye,typeof requestAnimationFrame!="undefined"?requestAnimationFrame:null,typeof console!="undefined"?console:null),ge=function(t){if(Object.prototype.toString.call(t)!=="[object Object]")return"";var r=[];for(var a in t)s(a,t[a]);return r.join("&");function s(m,l){if(Array.isArray(l))for(var f=0;f<l.length;f++)s(m+"["+f+"]",l[f]);else if(Object.prototype.toString.call(l)==="[object Object]")for(var f in l)s(m+"["+f+"]",l[f]);else r.push(encodeURIComponent(m)+(l!=null&&l!==""?"="+encodeURIComponent(l):""))}},we=Object.assign||function(t,r){for(var a in r)it.call(r,a)&&(t[a]=r[a])},jt=function(t,r){if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(r==null)return t;var a=t.indexOf("?"),s=t.indexOf("#"),m=s<0?t.length:s,l=a<0?m:a,f=t.slice(0,l),p={};we(p,r);var h=f.replace(/:([^\/\.-]+)(\.{3})?/g,function(w,N,S){return delete p[N],r[N]==null?w:S?r[N]:encodeURIComponent(String(r[N]))}),y=h.indexOf("?"),_=h.indexOf("#"),E=_<0?h.length:_,A=y<0?E:y,T=h.slice(0,A);a>=0&&(T+=t.slice(a,m)),y>=0&&(T+=(a<0?"?":"&")+h.slice(y,E));var b=ge(p);return b&&(T+=(a<0&&y<0?"?":"&")+b),s>=0&&(T+=t.slice(s)),_>=0&&(T+=(s<0?"":"&")+h.slice(_)),T},lr=function(t,r,a){var s=0;function m(p){return new r(p)}m.prototype=r.prototype,m.__proto__=r;function l(p){return function(h,y){typeof h!="string"?(y=h,h=h.url):y==null&&(y={});var _=new r(function(b,w){p(jt(h,y.params),y,function(N){if(typeof y.type=="function")if(Array.isArray(N))for(var S=0;S<N.length;S++)N[S]=new y.type(N[S]);else N=new y.type(N);b(N)},w)});if(y.background===!0)return _;var E=0;function A(){--E==0&&typeof a=="function"&&a()}return T(_);function T(b){var w=b.then;return b.constructor=m,b.then=function(){E++;var N=w.apply(b,arguments);return N.then(A,function(S){if(A(),E===0)throw S}),T(N)},b}}}function f(p,h){for(var y in p.headers)if(it.call(p.headers,y)&&y.toLowerCase()===h)return!0;return!1}return{request:l(function(p,h,y,_){var E=h.method!=null?h.method.toUpperCase():"GET",A=h.body,T=(h.serialize==null||h.serialize===JSON.serialize)&&!(A instanceof t.FormData||A instanceof t.URLSearchParams),b=h.responseType||(typeof h.extract=="function"?"":"json"),w=new t.XMLHttpRequest,N=!1,S=!1,V=w,P,C=w.abort;w.abort=function(){N=!0,C.call(this)},w.open(E,p,h.async!==!1,typeof h.user=="string"?h.user:void 0,typeof h.password=="string"?h.password:void 0),T&&A!=null&&!f(h,"content-type")&&w.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof h.deserialize!="function"&&!f(h,"accept")&&w.setRequestHeader("Accept","application/json, text/*"),h.withCredentials&&(w.withCredentials=h.withCredentials),h.timeout&&(w.timeout=h.timeout),w.responseType=b;for(var M in h.headers)it.call(h.headers,M)&&w.setRequestHeader(M,h.headers[M]);w.onreadystatechange=function(k){if(!N&&k.target.readyState===4)try{var B=k.target.status>=200&&k.target.status<300||k.target.status===304||/^file:\/\//i.test(p),L=k.target.response,I;if(b==="json"){if(!k.target.responseType&&typeof h.extract!="function")try{L=JSON.parse(k.target.responseText)}catch($){L=null}}else(!b||b==="text")&&L==null&&(L=k.target.responseText);if(typeof h.extract=="function"?(L=h.extract(k.target,h),B=!0):typeof h.deserialize=="function"&&(L=h.deserialize(L)),B)y(L);else{var G=function(){try{I=k.target.responseText}catch(ut){I=L}var $=new Error(I);$.code=k.target.status,$.response=L,_($)};w.status===0?setTimeout(function(){S||G()}):G()}}catch($){_($)}},w.ontimeout=function(k){S=!0;var B=new Error("Request timed out");B.code=k.target.status,_(B)},typeof h.config=="function"&&(w=h.config(w,h,p)||w,w!==V&&(P=w.abort,w.abort=function(){N=!0,P.call(this)})),A==null?w.send():typeof h.serialize=="function"?w.send(h.serialize(A)):A instanceof t.FormData||A instanceof t.URLSearchParams?w.send(A):w.send(JSON.stringify(A))}),jsonp:l(function(p,h,y,_){var E=h.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+s++,A=t.document.createElement("script");t[E]=function(T){delete t[E],A.parentNode.removeChild(A),y(T)},A.onerror=function(){delete t[E],A.parentNode.removeChild(A),_(new Error("JSONP request failed"))},A.src=p+(p.indexOf("?")<0?"?":"&")+encodeURIComponent(h.callbackKey||"callback")+"="+encodeURIComponent(E),t.document.documentElement.appendChild(A)})}},be=lr(typeof window!="undefined"?window:null,de,It.redraw);function xe(t){try{return decodeURIComponent(t)}catch(r){return t}}var _e=function(t){if(t===""||t==null)return{};t.charAt(0)==="?"&&(t=t.slice(1));for(var r=t.split("&"),a={},s={},m=0;m<r.length;m++){var l=r[m].split("="),f=xe(l[0]),p=l.length===2?xe(l[1]):"";p==="true"?p=!0:p==="false"&&(p=!1);var h=f.split(/\]\[?|\[/),y=s;f.indexOf("[")>-1&&h.pop();for(var _=0;_<h.length;_++){var E=h[_],A=h[_+1],T=A==""||!isNaN(parseInt(A,10));if(E===""){var f=h.slice(0,_).join();a[f]==null&&(a[f]=Array.isArray(y)?y.length:0),E=a[f]++}else if(E==="__proto__")break;if(_===h.length-1)y[E]=p;else{var b=Object.getOwnPropertyDescriptor(y,E);b!=null&&(b=b.value),b==null&&(y[E]=b=T?[]:{}),y=b}}}return s},Lt=function(t){var r=t.indexOf("?"),a=t.indexOf("#"),s=a<0?t.length:a,m=r<0?s:r,l=t.slice(0,m).replace(/\/{2,}/g,"/");return l?(l[0]!=="/"&&(l="/"+l),l.length>1&&l[l.length-1]==="/"&&(l=l.slice(0,-1))):l="/",{path:l,params:r<0?{}:_e(t.slice(r+1,s))}},fr=function(t){var r=Lt(t),a=Object.keys(r.params),s=[],m=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(l,f,p){return f==null?"\\"+l:(s.push({k:f,r:p==="..."}),p==="..."?"(.*)":p==="."?"([^/]+)\\.":"([^/]+)"+(p||""))})+"$");return function(l){for(var f=0;f<a.length;f++)if(r.params[a[f]]!==l.params[a[f]])return!1;if(!s.length)return m.test(l.path);var p=m.exec(l.path);if(p==null)return!1;for(var f=0;f<s.length;f++)l.params[s[f].k]=s[f].r?p[f+1]:decodeURIComponent(p[f+1]);return!0}},Ee=new RegExp("^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$"),Ae=function(t,r){var a={};if(r!=null)for(var s in t)it.call(t,s)&&!Ee.test(s)&&r.indexOf(s)<0&&(a[s]=t[s]);else for(var s in t)it.call(t,s)&&!Ee.test(s)&&(a[s]=t[s]);return a},Wt={};function ur(t){try{return decodeURIComponent(t)}catch(r){return t}}var hr=function(t,r){var a=t==null?null:typeof t.setImmediate=="function"?t.setImmediate:t.setTimeout,s=de.resolve(),m=!1,l=!1,f=0,p,h,y=Wt,_,E,A,T,b={onbeforeupdate:function(){return f=f?2:1,!(!f||Wt===y)},onremove:function(){t.removeEventListener("popstate",S,!1),t.removeEventListener("hashchange",N,!1)},view:function(){if(!(!f||Wt===y)){var C=[nt(_,E.key,E)];return y&&(C=y.render(C[0])),C}}},w=P.SKIP={};function N(){m=!1;var C=t.location.hash;P.prefix[0]!=="#"&&(C=t.location.search+C,P.prefix[0]!=="?"&&(C=t.location.pathname+C,C[0]!=="/"&&(C="/"+C)));var M=C.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,ur).slice(P.prefix.length),k=Lt(M);we(k.params,t.history.state);function B(I){console.error(I),V(h,null,{replace:!0})}L(0);function L(I){for(;I<p.length;I++)if(p[I].check(k)){var G=p[I].component,$=p[I].route,ut=G,ct=T=function(rt){if(ct===T){if(rt===w)return L(I+1);_=rt!=null&&(typeof rt.view=="function"||typeof rt=="function")?rt:"div",E=k.params,A=M,T=null,y=G.render?G:null,f===2?r.redraw():(f=2,r.redraw.sync())}};G.view||typeof G=="function"?(G={},ct(ut)):G.onmatch?s.then(function(){return G.onmatch(k.params,M,$)}).then(ct,M===h?null:B):ct("div");return}if(M===h)throw new Error("Could not resolve default route "+h+".");V(h,null,{replace:!0})}}function S(){m||(m=!0,a(N))}function V(C,M,k){if(C=jt(C,M),l){S();var B=k?k.state:null,L=k?k.title:null;k&&k.replace?t.history.replaceState(B,L,P.prefix+C):t.history.pushState(B,L,P.prefix+C)}else t.location.href=P.prefix+C}function P(C,M,k){if(!C)throw new TypeError("DOM element being rendered to does not exist.");if(p=Object.keys(k).map(function(L){if(L[0]!=="/")throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(L))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:L,component:k[L],check:fr(L)}}),h=M,M!=null){var B=Lt(M);if(!p.some(function(L){return L.check(B)}))throw new ReferenceError("Default route doesn't match any known routes.")}typeof t.history.pushState=="function"?t.addEventListener("popstate",S,!1):P.prefix[0]==="#"&&t.addEventListener("hashchange",N,!1),l=!0,r.mount(C,b),N()}return P.set=function(C,M,k){T!=null&&(k=k||{},k.replace=!0),T=null,V(C,M,k)},P.get=function(){return A},P.prefix="#!",P.Link={view:function(C){var M=Ct(C.attrs.selector||"a",Ae(C.attrs,["options","params","selector","onclick"]),C.children),k,B,L;return(M.attrs.disabled=Boolean(M.attrs.disabled))?(M.attrs.href=null,M.attrs["aria-disabled"]="true"):(k=C.attrs.options,B=C.attrs.onclick,L=jt(M.attrs.href,C.attrs.params),M.attrs.href=P.prefix+L,M.attrs.onclick=function(I){var G;typeof B=="function"?G=B.call(I.currentTarget,I):B==null||typeof B!="object"||typeof B.handleEvent=="function"&&B.handleEvent(I),G!==!1&&!I.defaultPrevented&&(I.button===0||I.which===0||I.which===1)&&(!I.currentTarget.target||I.currentTarget.target==="_self")&&!I.ctrlKey&&!I.metaKey&&!I.shiftKey&&!I.altKey&&(I.preventDefault(),I.redraw=!1,P.set(L,null,k))}),M}},P.param=function(C){return E&&C!=null?E[C]:E},P},mr=hr(typeof window!="undefined"?window:null,It),U=function(){return vt.apply(this,arguments)};U.m=vt;U.trust=vt.trust;U.fragment=vt.fragment;U.Fragment="[";U.mount=It.mount;U.route=mr;U.render=ye;U.redraw=It.redraw;U.request=be.request;U.jsonp=be.jsonp;U.parseQueryString=_e;U.buildQueryString=ge;U.parsePathname=Lt;U.buildPathname=jt;U.vnode=nt;U.PromisePolyfill=dt;U.censor=Ae;var pr=U,o=pr;var Zt=class{constructor(r,a,s){R(this,"lat");R(this,"lon");R(this,"timestamp");this.lat=r,this.lon=a,this.timestamp=s}};function Te(t,r,a,s){var m=6371,l=Nt(a-t),f=Nt(s-r),p=Math.sin(l/2)*Math.sin(l/2)+Math.cos(Nt(t))*Math.cos(Nt(a))*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),y=m*h;return y}function Nt(t){return t*(Math.PI/180)}var at=class{constructor(){R(this,"start_time");R(this,"start_position");R(this,"from");R(this,"stop_time");R(this,"stop_position");R(this,"to");R(this,"distance",0);R(this,"notes","");R(this,"samples",[])}static fromTuple(r){var a=new at;return r.length()==9&&(a.start_time=r[0],a.start_position=r[1],a.from=r[2],a.stop_time=r[3],a.stop_position=r[4],a.to=r[5],a.distance=r[6],a.notes=r[7],a.samples=r[8]),a}toTuple(){return[this.start_time,this.start_position,this.from,this.stop_time,this.stop_position,this.to,this.distance,this.notes,this.samples]}start(r){this.start_time=r}stop(r){this.stop_time=r,this.stop_position=this.samples.length>0?this.samples[this.samples.length-1]:this.start_position}addPosition(r){let a=new Zt(r.coords.latitude,r.coords.longitude,r.timestamp);if(this.samples.length>0){let s=this.samples[this.samples.length-1];this.distance+=Te(s.lat,s.lon,a.lat,a.lon)}else this.start_position=a;this.samples.push(a)}};var Yt=(t,r)=>r.some(a=>t instanceof a),ke,Ce;function dr(){return ke||(ke=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yr(){return Ce||(Ce=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Jt=new WeakMap,Qt=new WeakMap,Dt=new WeakMap;function gr(t){let r=new Promise((a,s)=>{let m=()=>{t.removeEventListener("success",l),t.removeEventListener("error",f)},l=()=>{a(st(t.result)),m()},f=()=>{s(t.error),m()};t.addEventListener("success",l),t.addEventListener("error",f)});return Dt.set(r,t),r}function wr(t){if(Jt.has(t))return;let r=new Promise((a,s)=>{let m=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",f),t.removeEventListener("abort",f)},l=()=>{a(),m()},f=()=>{s(t.error||new DOMException("AbortError","AbortError")),m()};t.addEventListener("complete",l),t.addEventListener("error",f),t.addEventListener("abort",f)});Jt.set(t,r)}var Xt={get(t,r,a){if(t instanceof IDBTransaction){if(r==="done")return Jt.get(t);if(r==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return st(t[r])},set(t,r,a){return t[r]=a,!0},has(t,r){return t instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in t}};function ve(t){Xt=t(Xt)}function br(t){return yr().includes(t)?function(...r){return t.apply($t(this),r),st(this.request)}:function(...r){return st(t.apply($t(this),r))}}function xr(t){return typeof t=="function"?br(t):(t instanceof IDBTransaction&&wr(t),Yt(t,dr())?new Proxy(t,Xt):t)}function st(t){if(t instanceof IDBRequest)return gr(t);if(Qt.has(t))return Qt.get(t);let r=xr(t);return r!==t&&(Qt.set(t,r),Dt.set(r,t)),r}var $t=t=>Dt.get(t);function Ie(t,r,{blocked:a,upgrade:s,blocking:m,terminated:l}={}){let f=indexedDB.open(t,r),p=st(f);return s&&f.addEventListener("upgradeneeded",h=>{s(st(f.result),h.oldVersion,h.newVersion,st(f.transaction),h)}),a&&f.addEventListener("blocked",h=>a(h.oldVersion,h.newVersion,h)),p.then(h=>{l&&h.addEventListener("close",()=>l()),m&&h.addEventListener("versionchange",y=>m(y.oldVersion,y.newVersion,y))}).catch(()=>{}),p}function je(t,{blocked:r}={}){let a=indexedDB.deleteDatabase(t);return r&&a.addEventListener("blocked",s=>r(s.oldVersion,s)),st(a).then(()=>{})}var _r=["get","getKey","getAll","getAllKeys","count"],Er=["put","add","delete","clear"],te=new Map;function Le(t,r){if(!(t instanceof IDBDatabase&&!(r in t)&&typeof r=="string"))return;if(te.get(r))return te.get(r);let a=r.replace(/FromIndex$/,""),s=r!==a,m=Er.includes(a);if(!(a in(s?IDBIndex:IDBObjectStore).prototype)||!(m||_r.includes(a)))return;let l=async function(f,...p){let h=this.transaction(f,m?"readwrite":"readonly"),y=h.store;return s&&(y=y.index(p.shift())),(await Promise.all([y[a](...p),m&&h.done]))[0]};return te.set(r,l),l}ve(t=>({...t,get:(r,a,s)=>Le(r,a)||t.get(r,a,s),has:(r,a)=>!!Le(r,a)||t.has(r,a)}));var Ar=["continue","continuePrimaryKey","advance"],Ne={},ee=new WeakMap,De=new WeakMap,Tr={get(t,r){if(!Ar.includes(r))return t[r];let a=Ne[r];return a||(a=Ne[r]=function(...s){ee.set(this,De.get(this)[r](...s))}),a}};async function*kr(...t){let r=this;if(r instanceof IDBCursor||(r=await r.openCursor(...t)),!r)return;r=r;let a=new Proxy(r,Tr);for(De.set(a,r),Dt.set(a,$t(r));r;)yield a,r=await(ee.get(a)||r.continue()),ee.delete(a)}function Me(t,r){return r===Symbol.asyncIterator&&Yt(t,[IDBIndex,IDBObjectStore,IDBCursor])||r==="iterate"&&Yt(t,[IDBIndex,IDBObjectStore])}ve(t=>({...t,get(r,a,s){return Me(r,a)?kr:t.get(r,a,s)},has(r,a){return Me(r,a)||t.has(r,a)}}));var _t=class{constructor(){R(this,"short");R(this,"name");R(this,"company");R(this,"street_adr_1");R(this,"city");R(this,"zip")}};var Cr=1,J,ot,re=class{constructor(){J.set(this,void 0);ot.set(this,void 0);R(this,"tracks",[]);R(this,"addresses",[])}async clearStorage(){v(this,ot)&&await je(v(this,ot))}async initTrackerStorage(r){tt(this,ot,r),tt(this,J,await Ie(v(this,ot),Cr,{upgrade(a,s){switch(s){case 0:{console.log("initializing db"),a.objectStoreNames.contains("tracks")||(console.log("creating tracks store"),a.createObjectStore("tracks",{keyPath:"start_time"})),a.objectStoreNames.contains("adr")||(a.createObjectStore("adr",{keyPath:"short"}),console.log("creating tracks adr"));break}}}})),this.tracks=await this.getTracksOverview(),this.addresses=await this.getAddresses(),console.log(`stored tracks ${this.tracks.length}`),console.log(`stored addresses ${this.addresses.length}`)}async clearTracks(){v(this,ot)&&(await v(this,J).transaction("tracks","readwrite").objectStore("tracks").clear(),this.tracks=[])}async storeTrack(r){let a=v(this,J).transaction("tracks","readwrite").store;try{await a.add(r),r.samples=[],this.tracks.push(r)}catch(s){if(s.name=="ConstraintError")alert("Track exists already"),console.log("error storing track");else throw console.log("error",s.message),s}}async countTracks(){return await v(this,J).transaction("tracks","readonly").store.count()}async getTracks(){return await v(this,J).transaction("tracks","readonly").store.getAll()}async mapTracks(r){let a=[],s=v(this,J).transaction("tracks","readonly");for await(let m of s.store)a.push(r(m.value));return a}async getTracksOverview(){let r=[],a=v(this,J).transaction("tracks","readonly");for await(let s of a.store){let m=s.value,l=new at;l.start_time=m.start_time,l.start_position=m.start_position,l.from=m.from,l.stop_time=m.stop_time,l.stop_position=m.stop_position,l.to=m.to,l.distance=m.distance,l.notes=m.notes,r.push(l)}return r}async storeAddress(r){let a=v(this,J).transaction("adr","readwrite").store;try{await a.add(r),this.addresses.push(r)}catch(s){if(s.name=="ConstraintError")alert("Address exists already");else throw console.log("error",s.message),s}}async delAddressByIndex(r){let a=this.addresses.splice(r,r);await v(this,J).transaction("adr","readwrite").store.delete(a.short)}async delAddressByShort(r){this.addresses=this.addresses.filter(function(s){return s.short!=r}),await v(this,J).transaction("adr","readwrite").store.delete(r)}async getAddresses(){let r=[],a=v(this,J).transaction("adr","readonly");for await(let s of a.store){let m=s.value,l=new _t;l.short=m.short,l.name=m.name,l.company=m.company,l.street_adr_1=m.street_adr_1,l.city=m.city,l.zip=m.zip,r.push(l)}return r}getAddressByShort(r){return this.addresses.find(function(a){return a.short==r})}};J=new WeakMap,ot=new WeakMap;var Q=Object.freeze({UNKNOWN:0,ERROR:1,READY:2,TRACKING:3,PAUSED:4,FINISHED:5}),ft,et,q,Et,Se,yt,ie,ne=class{constructor(){Et.add(this);yt.add(this);R(this,"storage",new re);R(this,"track",new at);ft.set(this,void 0);et.set(this,Q.UNKNOWN);q.set(this,void 0)}async initTracker(){let r=this.storage.initTrackerStorage("tlr_tracker");if(!navigator.geolocation)throw new Error("Geolocation is not supported by your browser");await r,tt(this,et,Q.READY),v(this,q)&&v(this,q).call(this)}getState(){return v(this,et)}isReady(){return v(this,et)>=Q.READY}setSatusCB(r){tt(this,q,r)}start(){this.track.start_time=Date.now(),mt(this,Et,Se).call(this)}pause(){mt(this,yt,ie).call(this),tt(this,et,Q.PAUSED),v(this,q)&&v(this,q).call(this)}resume(){mt(this,Et,Se).call(this),tt(this,et,Q.TRACKING),v(this,q)&&v(this,q).call(this)}stop(){this.track.stop(Date.now()),mt(this,yt,ie).call(this),tt(this,et,this.isReady()?Q.FINISHED:v(this,et)),v(this,q)&&v(this,q).call(this)}cancle(){mt(this,yt,ie).call(this),this.reset()}async save(){this.track.samples.length>0&&await this.storage.storeTrack(this.track),this.reset()}reset(){this.track=new at,tt(this,et,this.isReady()?Q.READY:v(this,et)),v(this,q)&&v(this,q).call(this)}onNewPosition(r){r&&(this.track.addPosition(r),v(this,q)&&v(this,q).call(this))}onPositionError(r){throw new Error(r.code)}};ft=new WeakMap,et=new WeakMap,q=new WeakMap,Et=new WeakSet,Se=function(){tt(this,ft,navigator.geolocation.watchPosition(this.onNewPosition.bind(this),this.onPositionError.bind(this),{enableHighAccuracy:!0,timeout:6e4,maximumAge:0})),tt(this,et,Q.TRACKING),v(this,q)&&v(this,q).call(this)},yt=new WeakSet,ie=function(){v(this,ft)&&(navigator.geolocation.clearWatch(v(this,ft)),tt(this,ft,null))};var X={view:({attrs:{type:t,text:r,onclick:a,id:s,disabled:m,left:l}})=>o("button",{id:s,class:"oval-lg",type:t||"button",disabled:m,onclick:a,style:"float: "+(l?"none":"right")},r)};var vr=["UNBEKANNT","FEHLER","BEREIT","AUFNAHME","PAUSE","FERTIG"];function Re(t){return o(X,{text:"Abbruch",left:!0,onclick:()=>{t.stop(),t.reset()}})}function ze(t){return o(X,{text:"Stop",left:!0,onclick:async()=>{t.stop();let r=document.getElementById("ffrom").value,a=document.getElementById("fto").value;t.track.from=r,t.track.to=a,await t.save()}})}function Ir(t){var r;switch(t.getState()){case Q.UNKNWON:case Q.ERROR:r=o(X,{text:"Connect",onclick:()=>{t.init()}});break;case Q.READY:r=o(X,{text:"Start",left:!0,onclick:()=>{console.log("start"),t.start()}});break;case Q.TRACKING:r=[o(X,{text:"Pause",left:!0,onclick:()=>{console.log("pause"),t.pause()}}),ze(t),Re(t)];break;case Q.PAUSED:r=[o(X,{text:"Weiter",left:!0,onclick:()=>{console.log("resume"),t.resume()}}),ze(t),Re(t)];break}return o(".ctrl",r)}var jr={view:function(t){return o("datalist",{id:"adr_shorts"},t.attrs.storage.addresses.map(function(r){return o("option",{value:r.short},r.short)}))}},Pe={view:t=>{let r=t.attrs.tracker;return console.log("creating tracking view"),o("div.app",o("header",o("h1.gradient-text","Aufnahme")),o("main",o(".card",o(".stat-item",`Status: ${vr[r.getState()]}`),o(".stat-item",`Distanz: ${r.track.distance}`),o(".stat-item",`Datenpunkte: ${r.track.samples.length}`)),o(jr,{storage:r.storage}),o(".card",o("form",o("label[for='ffrom']","Von:"),o("input.oval-xlg[id='ffrom'][name='ffrom'][type='text'][list='adr_shorts'][placeholder=Kurz]"),o("label[for='fto']","Nach:"),o("input.oval-xlg[id='fto'][name='fto'][type='text'][list='adr_shorts'][placeholder=Kurz]"))),o(".spaced-container",Ir(r))),o("footer","TLR Tools"))}};var Be=(t,r)=>{let a=Math.abs(t-r),s=Math.floor(a/36e5);a-=s*36e5;let m=Math.floor(a/6e4);a-=m*6e4;let l=Math.floor(a/1e3);return`${s}:${("0"+m).slice(-2)}:${("0"+l).slice(-2)}`};function Oe(t){let r="";return t.name&&t.name.length>0&&(r+=t.name+","),t.company&&t.company.length>0&&(r+=t.company+","),r+=t.street_adr_1+","+t.zip+" "+t.city,r}async function Lr(t,r,a,s){let m=r?";Von":"",l=r?";Nach":"",f=a?";Abfahrt lat;Abfahrt lon":"",p=a?";Ankunft lat;Ankunft lon":"",h=s?";Samples":"",y=["Abfahrt Datum;Abfahrt Zeit"+m+f+";Ankunft Datum;Ankunft Zeit"+l+p+";Strecke [km];Fahrtdauer [h:m:s]"+h],_=0,E=await t.mapTracks(function(b){console.log(`Export track #${_}`),console.log(b),_+=1;let w=[new Date(b.start_time).toLocaleString().replace(",",";")];var N="";if(r){let S=t.getAddressByShort(b.from),V=S?Oe(S):"",P=t.getAddressByShort(b.to);N=S?Oe(P):"",w.push(V)}return a&&w.push(`${b.start_position.lat.toString()};${b.start_position.lon.toString()}`),w.push(new Date(b.stop_time).toLocaleString().replace(",",";")),r&&w.push(N),a&&w.push(`${b.stop_position.lat.toString()};${b.stop_position.lon.toString()}`),w.push(b.distance>0?(b.distance/1e3).toString():"0"),w.push(Be(b.stop_time,b.start_time)),w.push(b.samples.map(S=>`(${S.lat},${S.lon},${S.timestamp})`).join(",")),w.join(";")});y.push(E.join(`
`)),y=y.join(`
`);let A=new Blob([y],{type:"text/csv;charset=utf-8,"}),T=URL.createObjectURL(A);window.open(T)}var He={view:t=>{var r=t.attrs.storage.tracks;let a=r.length>0?r.reduce(function(s,m){return s+m.distance}):0;return o("div.app",o("header",o("h1.gradient-text","Gespeicherte Routen")),o("main",[o(".card",o(".stat-item",`Gesamt km: ${a>0?(a/1e3).toFixed(3):"0.0"}`),o(".stat-item",`Strecken: ${r.length}`)),o(".card",o("table",o("thead",o("tr",o("th","Datum"),o("th","Dauer"),o("th","Distanz [km]"),o("th","Von"),o("th","Nach"))),o("tbody",r.map(function(s){return o("tr",o("th",new Date(s.start_time).toLocaleString()),o("th",Be(s.stop_time,s.start_time)),o("th",(s.distance/1e3).toFixed(2)),o("th",s.from),o("th",s.to))})))),o(".card",o(".spaced-container",o("div",o("label",{for:"export_adr"},"Adressen"),o("input",{id:"export_adr",type:"checkbox"})),o("div",o("label",{for:"export_st_coords"},"Start/Stop Koordinaten"),o("input",{id:"export_st_coords",type:"checkbox"})),o("div",o("label",{for:"export_samples"},"GPS Punkte"),o("input",{id:"export_samples",type:"checkbox"})))),o(".spaced-container",o(X,{text:"Export",left:!0,onclick:async()=>{console.log("export");let s=document.getElementById("export_adr").checked,m=document.getElementById("export_st_coords").checked,l=document.getElementById("export_samples").checked;await Lr(t.attrs.storage,s,m,l)}}),o(X,{text:"Leeren",left:!0,onclick:async()=>{console.log("clear"),await t.attrs.storage.clearTracks()}}))]),o("footer","TLR Tools"))}};var Nr=o("svg",{class:"icon",viewBox:"0 0 40 40"},o("path",{d:"M19.6 1C28.2 1 35.2 8 35.2 16.6 35.2 20.5 33.7 24.2 31.1 27.1L30.8 27.3 19.6 39 8.4 27.5C2.4 21.3 2.5 11.5 8.7 5.4 11.4 2.8 15 1.2 18.8 1L19.2 1 19.6 1ZM19.6 4.9L19.3 4.9C16.4 5 13.5 6.2 11.4 8.2 6.9 12.7 6.7 19.9 11 24.6L11.2 24.8 19.6 33.4 28 24.7C30 22.6 31.1 20 31.3 17.3L31.3 16.9 31.3 16.6C31.3 10.2 26.2 5 19.9 4.9L19.6 4.9ZM19.6 13.3C21.4 13.3 23 14.8 23 16.7 23 18.6 21.4 20.1 19.6 20.1 17.7 20.1 16.2 18.6 16.2 16.7 16.2 14.8 17.7 13.3 19.6 13.3Z"})),Dr=o("svg",{class:"icon",viewBox:"0 0 24 24"},o("path",{d:"M8 6L21 6.00078M8 12L21 12.0008M8 18L21 18.0007M3 6.5H4V5.5H3V6.5ZM3 12.5H4V11.5H3V12.5ZM3 18.5H4V17.5H3V18.5Z",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})),Mr=o("svg",{class:"icon",viewBox:"0 -32 576 576"},o("path",{d:"M528 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm0 400H48V80h480v352zM208 256c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm-89.6 128h179.2c12.4 0 22.4-8.6 22.4-19.2v-19.2c0-31.8-30.1-57.6-67.2-57.6-10.8 0-18.7 8-44.8 8-26.9 0-33.4-8-44.8-8-37.1 0-67.2 25.8-67.2 57.6v19.2c0 10.6 10 19.2 22.4 19.2zM360 320h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8z"})),Mt={view:function(t){return o("main.layout",[o(".menu",[o(o.route.Link,{href:"/tracker"},Nr),o(o.route.Link,{href:"/tracks"},Dr),o(o.route.Link,{href:"/adr"},Mr)]),o("section",t.children)])}};async function Sr(t){var r=new _t;r.short=document.getElementById("fshort").value,r.name=document.getElementById("fname").value,r.company=document.getElementById("fcompany").value,r.street_adr_1=document.getElementById("fstreet").value,r.city=document.getElementById("fcity").value,r.zip=document.getElementById("fzip").value,await t.storeAddress(r)}function Rr(t){var r=document.getElementById("fshort").value,a=document.getElementById("new_adr_save");r?t.addresses.some(function(s){return s.short==r})?(alert("Abkürzung breits vorhanden"),a.disabled=!0):a.disabled&&(a.disabled=!1):(alert("Abkürzung darf nicht leer sein"),a.disabled=!0)}var En=o("svg",{class:"icon",viewBox:"0 0 256 256"},o("path",{d:"M197.8,10.6c-6.3,1.6-1.6-3-86.9,82.3l-79.2,79.2L20.7,205c-9.3,27.9-10.9,33.2-10.7,34.8c0.4,3.2,3,5.8,6.2,6.2c1.6,0.2,6.9-1.4,34.8-10.7l32.9-10.9l78.3-78.3c43.1-43,79-79.3,79.9-80.5c4.6-6.9,5.1-15.2,1.6-22.8c-1.2-2.6-3-4.6-13.8-15.5c-8-8.1-13.3-13.1-15-14.1C210.1,10.2,203.3,9.2,197.8,10.6z M206.6,25.6c2.5,1.2,23,21.8,24,24.1c0.9,2.2,0.9,4.1,0,6.3c-0.5,1.1-4.4,5.4-11.2,12.2l-10.5,10.5l-15.8-15.8l-15.8-15.8l10.3-10.3c6-6,11-10.7,12.1-11.2C202,24.5,204.2,24.5,206.6,25.6z M182.7,73.6l15.7,15.7l-61,61l-61,61L53,219.1c-12.8,4.2-23.4,7.7-23.6,7.5c-0.1-0.1,3.2-10.7,7.5-23.5l7.7-23.2l61-61c33.5-33.5,61-61,61.2-61C166.9,57.9,174,65,182.7,73.6z"})),zr=o("svg",{class:"icon",viewBox:"0 0 256 256"},o("path",{fill:"#000000",d:"M95.8,213.8c3.2,0,5.4-2.7,5.4-5.4l-8-128.7c0-3.2-2.7-5.4-5.4-5.4c-3.2,0-5.4,2.7-5.4,5.4l8,128.7C90.5,211.7,93.1,213.8,95.8,213.8z M219.2,42.2h-53.6V20.7c0-5.9-4.8-10.7-10.7-10.7h-53.7c-5.9,0-10.7,4.8-10.7,10.7v21.5H36.8c-3.2,0-5.4,2.1-5.4,5.4c0,3.2,2.1,5.4,5.4,5.4h10.7l10.7,171.6c1.6,11.8,9.7,21.5,21.5,21.5h96.5c11.8,0,19.3-9.7,21.5-21.5l10.7-171.6h10.7c3.2,0,5.4-2.1,5.4-5.4C224.6,44.3,222.4,42.2,219.2,42.2z M101.2,20.7h53.6v21.5h-53.6V20.7z M187,224.5c-0.5,5.9-4.8,10.7-10.7,10.7H79.7c-5.9,0-9.7-4.8-10.7-10.7L58.3,52.9h139.5L187,224.5z M160.2,213.8c3.2,0,5.4-2.1,5.4-5.4l8-128.7c0-3.2-2.1-5.4-5.4-5.4c-3.2,0-5.4,2.1-5.4,5.4l-8,128.7C154.8,211.1,157,213.8,160.2,213.8z M128,213.8c3.2,0,5.4-2.1,5.4-5.4V79.7c0-3.2-2.1-5.4-5.4-5.4c-3.2,0-5.4,2.1-5.4,5.4v128.7C122.6,211.7,124.8,213.8,128,213.8z"}));var Fe={view:t=>{let r=t.attrs.storage;return o("div.app",o("header",o("h1.gradient-text","Gespeicherte Addressen")),o("main",o(".card",o("form",o("input.oval-xlg[id='fshort'][required][name='fshort'][type='text'][placeholder=Kurz]",{onblur:async a=>{a.redraw=!1,console.log("blur new address"),Rr(r)}}),o("br"),o("input.oval-xlg[id='fname'][name='fname'][type='text'][placeholder=Name]"),o("br"),o("input.oval-xlg[id='fcompany'][name='fcompany'][type='text'][placeholder=Firma]"),o("br"),o("input.oval-xlg[id='fstreet'][name='fstreet'][type='text'][placeholder=Fake Street 19]"),o("br"),o("input.oval-xlg[id='fcity'][name='fcity'][type='text'][placeholder=Stuttgart]"),o("br"),o("input.oval-xlg[id='fzip'][name='fzip'][type='text'][placeholder=72304]"),o("br"),o(X,{text:"Speichern",id:"new_adr_save",left:!0,onclick:async()=>{console.log("save new address"),Sr(r)}}))),r.addresses.map(function(a){return o(".card",o(".spaced-container",o("div",`${a.short}`),o(X,{text:zr,left:!0,onclick:async()=>{console.log(`delete address ${a.short}`),await r.delAddressByShort(a.short)}})),o("div",`${a.name}`),o("div",`${a.company}`),o("div",`${a.street_adr_1}`),o("div",`${a.zip} ${a.city}`))}),o(".card",o(X,{text:"Leeren",left:!0,onclick:async()=>{console.log("clear addresses")}}))),o("footer","TLR Tools"))}};var gt=new ne;gt.initTracker().then(gt.setSatusCB(o.redraw));var Pr={view:()=>o("h1","Loading...")};o.route(document.body,"/tracker",{"/tracker":{render:function(t){return o(Mt,gt.isReady()?o(Pe,{tracker:gt}):o(Pr))}},"/tracks":{render:function(t){return o(Mt,o(He,{storage:gt.storage}))}},"/adr":{render:function(t){return o(Mt,o(Fe,{storage:gt.storage}))}}});
//# sourceMappingURL=index.js.map
