var Je=Object.defineProperty;var Qe=(t,r,a)=>r in t?Je(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a;var z=(t,r,a)=>(Qe(t,typeof r!="symbol"?r+"":r,a),a),Vt=(t,r,a)=>{if(!r.has(t))throw TypeError("Cannot "+a)},O=(t,r,a)=>(Vt(t,r,"read from private field"),a?a.call(t):r.get(t)),tt=(t,r,a,s)=>(Vt(t,r,"write to private field"),s?s.call(t,a):r.set(t,a),a),ht=(t,r,a)=>(Vt(t,r,"access private method"),a);function ct(t,r,a,s,m,l){return{tag:t,key:r,attrs:a,children:s,text:m,dom:l,domSize:void 0,state:void 0,events:void 0,instance:void 0}}ct.normalize=function(t){return Array.isArray(t)?ct("[",void 0,void 0,ct.normalizeChildren(t),void 0,void 0):t==null||typeof t=="boolean"?null:typeof t=="object"?t:ct("#",void 0,void 0,String(t),void 0,void 0)};ct.normalizeChildren=function(t){var r=[];if(t.length){for(var a=t[0]!=null&&t[0].key!=null,s=1;s<t.length;s++)if((t[s]!=null&&t[s].key!=null)!==a)throw new TypeError(a&&(t[s]!=null||typeof t[s]=="boolean")?"In fragments, vnodes must either all have keys or none have keys. You may wish to consider using an explicit keyed empty fragment, m.fragment({key: ...}), instead of a hole.":"In fragments, vnodes must either all have keys or none have keys.");for(var s=0;s<t.length;s++)r[s]=ct.normalize(t[s])}return r};var rt=ct,ue=function(){var t=arguments[this],r=this+1,a;if(t==null?t={}:(typeof t!="object"||t.tag!=null||Array.isArray(t))&&(t={},r=this),arguments.length===r+1)a=arguments[r],Array.isArray(a)||(a=[a]);else for(a=[];r<arguments.length;)a.push(arguments[r++]);return rt("",t.key,t,a)},nt={}.hasOwnProperty,Xe=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g,he={};function me(t){for(var r in t)if(nt.call(t,r))return!1;return!0}function $e(t){for(var r,a="div",s=[],m={};r=Xe.exec(t);){var l=r[1],f=r[2];if(l===""&&f!=="")a=f;else if(l==="#")m.id=f;else if(l===".")s.push(f);else if(r[3][0]==="["){var p=r[6];p&&(p=p.replace(/\\(["'])/g,"$1").replace(/\\\\/g,"\\")),r[4]==="class"?s.push(p):m[r[4]]=p===""?p:p||!0}}return s.length>0&&(m.className=s.join(" ")),he[t]={tag:a,attrs:m}}function tr(t,r){var a=r.attrs,s=nt.call(a,"class"),m=s?a.class:a.className;if(r.tag=t.tag,r.attrs={},!me(t.attrs)&&!me(a)){var l={};for(var f in a)nt.call(a,f)&&(l[f]=a[f]);a=l}for(var f in t.attrs)nt.call(t.attrs,f)&&f!=="className"&&!nt.call(a,f)&&(a[f]=t.attrs[f]);(m!=null||t.attrs.className!=null)&&(a.className=m!=null?t.attrs.className!=null?String(t.attrs.className)+" "+String(m):m:t.attrs.className!=null?t.attrs.className:null),s&&(a.class=null);for(var f in a)if(nt.call(a,f)&&f!=="key"){r.attrs=a;break}return r}function er(t){if(t==null||typeof t!="string"&&typeof t!="function"&&typeof t.view!="function")throw Error("The selector must be either a string or a component.");var r=ue.apply(1,arguments);return typeof t=="string"&&(r.children=rt.normalizeChildren(r.children),t!=="[")?tr(he[t]||$e(t),r):(r.tag=t,r)}var kt=er,rr=function(t){return t==null&&(t=""),rt("<",void 0,void 0,t,void 0,void 0)},nr=function(){var t=ue.apply(0,arguments);return t.tag="[",t.children=rt.normalizeChildren(t.children),t};kt.trust=rr;kt.fragment=nr;var Ct=kt,mt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ar(t,r,a){return a={path:r,exports:{},require:function(s,m){return ir(s,m??a.path)}},t(a,a.exports),a.exports}function ir(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var K=function(t){if(!(this instanceof K))throw new Error("Promise must be called with 'new'.");if(typeof t!="function")throw new TypeError("executor must be a function.");var r=this,a=[],s=[],m=h(a,!0),l=h(s,!1),f=r._instance={resolvers:a,rejectors:s},p=typeof setImmediate=="function"?setImmediate:setTimeout;function h(_,E){return function A(T){var b;try{if(E&&T!=null&&(typeof T=="object"||typeof T=="function")&&typeof(b=T.then)=="function"){if(T===r)throw new TypeError("Promise can't be resolved with itself.");g(b.bind(T))}else p(function(){!E&&_.length===0&&console.error("Possible unhandled promise rejection:",T);for(var w=0;w<_.length;w++)_[w](T);a.length=0,s.length=0,f.state=E,f.retry=function(){A(T)}})}catch(w){l(w)}}}function g(_){var E=0;function A(b){return function(w){E++>0||b(w)}}var T=A(l);try{_(A(m),T)}catch(b){T(b)}}g(t)};K.prototype.then=function(t,r){var a=this,s=a._instance;function m(h,g,_,E){g.push(function(A){if(typeof h!="function")_(A);else try{l(h(A))}catch(T){f&&f(T)}}),typeof s.retry=="function"&&E===s.state&&s.retry()}var l,f,p=new K(function(h,g){l=h,f=g});return m(t,s.resolvers,l,!0),m(r,s.rejectors,f,!1),p};K.prototype.catch=function(t){return this.then(null,t)};K.prototype.finally=function(t){return this.then(function(r){return K.resolve(t()).then(function(){return r})},function(r){return K.resolve(t()).then(function(){return K.reject(r)})})};K.resolve=function(t){return t instanceof K?t:new K(function(r){r(t)})};K.reject=function(t){return new K(function(r,a){a(t)})};K.all=function(t){return new K(function(r,a){var s=t.length,m=0,l=[];if(t.length===0)r([]);else for(var f=0;f<t.length;f++)(function(p){function h(g){m++,l[p]=g,m===s&&r(l)}t[p]!=null&&(typeof t[p]=="object"||typeof t[p]=="function")&&typeof t[p].then=="function"?t[p].then(h,a):h(t[p])})(f)})};K.race=function(t){return new K(function(r,a){for(var s=0;s<t.length;s++)t[s].then(r,a)})};var pt=K,pe=ar(function(t){typeof window!="undefined"?(typeof window.Promise=="undefined"?window.Promise=pt:window.Promise.prototype.finally||(window.Promise.prototype.finally=pt.prototype.finally),t.exports=window.Promise):typeof mt!="undefined"?(typeof mt.Promise=="undefined"?mt.Promise=pt:mt.Promise.prototype.finally||(mt.Promise.prototype.finally=pt.prototype.finally),t.exports=mt.Promise):t.exports=pt}),sr=function(t){var r=t&&t.document,a,s={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"};function m(n){return n.attrs&&n.attrs.xmlns||s[n.tag]}function l(n,e){if(n.state!==e)throw new Error("'vnode.state' must not be modified.")}function f(n){var e=n.state;try{return this.apply(e,arguments)}finally{l(n,e)}}function p(){try{return r.activeElement}catch(n){return null}}function h(n,e,i,c,u,d,x){for(var I=i;I<c;I++){var y=e[I];y!=null&&g(n,y,u,x,d)}}function g(n,e,i,c,u){var d=e.tag;if(typeof d=="string")switch(e.state={},e.attrs!=null&&St(e.attrs,e,i),d){case"#":_(n,e,u);break;case"<":A(n,e,c,u);break;case"[":T(n,e,i,c,u);break;default:b(n,e,i,c,u)}else N(n,e,i,c,u)}function _(n,e,i){e.dom=r.createTextNode(e.children),et(n,e.dom,i)}var E={caption:"table",thead:"table",tbody:"table",tfoot:"table",tr:"tbody",th:"tr",td:"tr",colgroup:"table",col:"colgroup"};function A(n,e,i,c){var u=e.children.match(/^\s*?<(\w+)/im)||[],d=r.createElement(E[u[1]]||"div");i==="http://www.w3.org/2000/svg"?(d.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+e.children+"</svg>",d=d.firstChild):d.innerHTML=e.children,e.dom=d.firstChild,e.domSize=d.childNodes.length,e.instance=[];for(var x=r.createDocumentFragment(),I;I=d.firstChild;)e.instance.push(I),x.appendChild(I);et(n,x,c)}function T(n,e,i,c,u){var d=r.createDocumentFragment();if(e.children!=null){var x=e.children;h(d,x,0,x.length,i,null,c)}e.dom=d.firstChild,e.domSize=d.childNodes.length,et(n,d,u)}function b(n,e,i,c,u){var d=e.tag,x=e.attrs,I=x&&x.is;c=m(e)||c;var y=c?I?r.createElementNS(c,d,{is:I}):r.createElementNS(c,d):I?r.createElement(d,{is:I}):r.createElement(d);if(e.dom=y,x!=null&&Fe(e,x,c),et(n,y,u),!ie(e)&&e.children!=null){var L=e.children;h(y,L,0,L.length,i,null,c),e.tag==="select"&&x!=null&&Ue(e,x)}}function w(n,e){var i;if(typeof n.tag.view=="function"){if(n.state=Object.create(n.tag),i=n.state.view,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0}else{if(n.state=void 0,i=n.tag,i.$$reentrantLock$$!=null)return;i.$$reentrantLock$$=!0,n.state=n.tag.prototype!=null&&typeof n.tag.prototype.view=="function"?new n.tag(n):n.tag(n)}if(St(n.state,n,e),n.attrs!=null&&St(n.attrs,n,e),n.instance=rt.normalize(f.call(n.state.view,n)),n.instance===n)throw Error("A view cannot return the vnode it received as argument");i.$$reentrantLock$$=null}function N(n,e,i,c,u){w(e,i),e.instance!=null?(g(n,e.instance,i,c,u),e.dom=e.instance.dom,e.domSize=e.dom!=null?e.instance.domSize:0):e.domSize=0}function M(n,e,i,c,u,d){if(!(e===i||e==null&&i==null))if(e==null||e.length===0)h(n,i,0,i.length,c,u,d);else if(i==null||i.length===0)gt(n,e,0,e.length);else{var x=e[0]!=null&&e[0].key!=null,I=i[0]!=null&&i[0].key!=null,y=0,L=0;if(!x)for(;L<e.length&&e[L]==null;)L++;if(!I)for(;y<i.length&&i[y]==null;)y++;if(x!==I)gt(n,e,L,e.length),h(n,i,y,i.length,c,u,d);else if(I){for(var W=e.length-1,F=i.length-1,Tt,Z,H,G,P,Ht;W>=L&&F>=y&&(G=e[W],P=i[F],G.key===P.key);)G!==P&&q(n,G,P,c,u,d),P.dom!=null&&(u=P.dom),W--,F--;for(;W>=L&&F>=y&&(Z=e[L],H=i[y],Z.key===H.key);)L++,y++,Z!==H&&q(n,Z,H,c,X(e,L,u),d);for(;W>=L&&F>=y&&!(y===F||Z.key!==P.key||G.key!==H.key);)Ht=X(e,L,u),ft(n,G,Ht),G!==H&&q(n,G,H,c,Ht,d),++y<=--F&&ft(n,Z,u),Z!==P&&q(n,Z,P,c,u,d),P.dom!=null&&(u=P.dom),L++,W--,G=e[W],P=i[F],Z=e[L],H=i[y];for(;W>=L&&F>=y&&G.key===P.key;)G!==P&&q(n,G,P,c,u,d),P.dom!=null&&(u=P.dom),W--,F--,G=e[W],P=i[F];if(y>F)gt(n,e,L,W+1);else if(L>W)h(n,i,y,F+1,c,u,d);else{var Ye=u,fe=F-y+1,wt=new Array(fe),Ft=0,B=0,Kt=2147483647,Ut=0,Tt,qt;for(B=0;B<fe;B++)wt[B]=-1;for(B=F;B>=y;B--){Tt==null&&(Tt=j(e,L,W+1)),P=i[B];var ut=Tt[P.key];ut!=null&&(Kt=ut<Kt?ut:-1,wt[B-y]=ut,G=e[ut],e[ut]=null,G!==P&&q(n,G,P,c,u,d),P.dom!=null&&(u=P.dom),Ut++)}if(u=Ye,Ut!==W-L+1&&gt(n,e,L,W+1),Ut===0)h(n,i,y,F+1,c,u,d);else if(Kt===-1)for(qt=V(wt),Ft=qt.length-1,B=F;B>=y;B--)H=i[B],wt[B-y]===-1?g(n,H,c,d,u):qt[Ft]===B-y?Ft--:ft(n,H,u),H.dom!=null&&(u=i[B].dom);else for(B=F;B>=y;B--)H=i[B],wt[B-y]===-1&&g(n,H,c,d,u),H.dom!=null&&(u=i[B].dom)}}else{var Ot=e.length<i.length?e.length:i.length;for(y=y<L?y:L;y<Ot;y++)Z=e[y],H=i[y],!(Z===H||Z==null&&H==null)&&(Z==null?g(n,H,c,d,X(e,y+1,u)):H==null?Et(n,Z):q(n,Z,H,c,X(e,y+1,u),d));e.length>Ot&&gt(n,e,y,e.length),i.length>Ot&&h(n,i,y,i.length,c,u,d)}}}function q(n,e,i,c,u,d){var x=e.tag,I=i.tag;if(x===I){if(i.state=e.state,i.events=e.events,Ze(i,e))return;if(typeof x=="string")switch(i.attrs!=null&&Bt(i.attrs,i,c),x){case"#":R(e,i);break;case"<":C(n,e,i,d,u);break;case"[":D(n,e,i,c,u,d);break;default:k(e,i,c,d)}else S(n,e,i,c,u,d)}else Et(n,e),g(n,i,c,d,u)}function R(n,e){n.children.toString()!==e.children.toString()&&(n.dom.nodeValue=e.children),e.dom=n.dom}function C(n,e,i,c,u){e.children!==i.children?(ae(n,e),A(n,i,c,u)):(i.dom=e.dom,i.domSize=e.domSize,i.instance=e.instance)}function D(n,e,i,c,u,d){M(n,e.children,i.children,c,u,d);var x=0,I=i.children;if(i.dom=null,I!=null){for(var y=0;y<I.length;y++){var L=I[y];L!=null&&L.dom!=null&&(i.dom==null&&(i.dom=L.dom),x+=L.domSize||1)}x!==1&&(i.domSize=x)}}function k(n,e,i,c){var u=e.dom=n.dom;c=m(e)||c,e.tag==="textarea"&&e.attrs==null&&(e.attrs={}),qe(e,n.attrs,e.attrs,c),ie(e)||M(u,n.children,e.children,i,null,c)}function S(n,e,i,c,u,d){if(i.instance=rt.normalize(f.call(i.state.view,i)),i.instance===i)throw Error("A view cannot return the vnode it received as argument");Bt(i.state,i,c),i.attrs!=null&&Bt(i.attrs,i,c),i.instance!=null?(e.instance==null?g(n,i.instance,c,d,u):q(n,e.instance,i.instance,c,u,d),i.dom=i.instance.dom,i.domSize=i.instance.domSize):e.instance!=null?(Et(n,e.instance),i.dom=void 0,i.domSize=0):(i.dom=e.dom,i.domSize=e.domSize)}function j(n,e,i){for(var c=Object.create(null);e<i;e++){var u=n[e];if(u!=null){var d=u.key;d!=null&&(c[d]=e)}}return c}var v=[];function V(n){for(var e=[0],i=0,c=0,u=0,d=v.length=n.length,u=0;u<d;u++)v[u]=n[u];for(var u=0;u<d;++u)if(n[u]!==-1){var x=e[e.length-1];if(n[x]<n[u]){v[u]=x,e.push(u);continue}for(i=0,c=e.length-1;i<c;){var I=(i>>>1)+(c>>>1)+(i&c&1);n[e[I]]<n[u]?i=I+1:c=I}n[u]<n[e[i]]&&(i>0&&(v[u]=e[i-1]),e[i]=u)}for(i=e.length,c=e[i-1];i-- >0;)e[i]=c,c=v[c];return v.length=0,e}function X(n,e,i){for(;e<n.length;e++)if(n[e]!=null&&n[e].dom!=null)return n[e].dom;return i}function ft(n,e,i){var c=r.createDocumentFragment();ot(n,c,e),et(n,c,i)}function ot(n,e,i){for(;i.dom!=null&&i.dom.parentNode===n;){if(typeof i.tag!="string"){if(i=i.instance,i!=null)continue}else if(i.tag==="<")for(var c=0;c<i.instance.length;c++)e.appendChild(i.instance[c]);else if(i.tag!=="[")e.appendChild(i.dom);else if(i.children.length===1){if(i=i.children[0],i!=null)continue}else for(var c=0;c<i.children.length;c++){var u=i.children[c];u!=null&&ot(n,e,u)}break}}function et(n,e,i){i!=null?n.insertBefore(e,i):n.appendChild(e)}function ie(n){if(n.attrs==null||n.attrs.contenteditable==null&&n.attrs.contentEditable==null)return!1;var e=n.children;if(e!=null&&e.length===1&&e[0].tag==="<"){var i=e[0].children;n.dom.innerHTML!==i&&(n.dom.innerHTML=i)}else if(e!=null&&e.length!==0)throw new Error("Child node of a contenteditable must be trusted.");return!0}function gt(n,e,i,c){for(var u=i;u<c;u++){var d=e[u];d!=null&&Et(n,d)}}function Et(n,e){var i=0,c=e.state,u,d;if(typeof e.tag!="string"&&typeof e.state.onbeforeremove=="function"){var x=f.call(e.state.onbeforeremove,e);x!=null&&typeof x.then=="function"&&(i=1,u=x)}if(e.attrs&&typeof e.attrs.onbeforeremove=="function"){var x=f.call(e.attrs.onbeforeremove,e);x!=null&&typeof x.then=="function"&&(i|=2,d=x)}if(l(e,c),!i)At(e),Mt(n,e);else{if(u!=null){var I=function(){i&1&&(i&=2,i||y())};u.then(I,I)}if(d!=null){var I=function(){i&2&&(i&=1,i||y())};d.then(I,I)}}function y(){l(e,c),At(e),Mt(n,e)}}function ae(n,e){for(var i=0;i<e.instance.length;i++)n.removeChild(e.instance[i])}function Mt(n,e){for(;e.dom!=null&&e.dom.parentNode===n;){if(typeof e.tag!="string"){if(e=e.instance,e!=null)continue}else if(e.tag==="<")ae(n,e);else{if(e.tag!=="["&&(n.removeChild(e.dom),!Array.isArray(e.children)))break;if(e.children.length===1){if(e=e.children[0],e!=null)continue}else for(var i=0;i<e.children.length;i++){var c=e.children[i];c!=null&&Mt(n,c)}}break}}function At(n){if(typeof n.tag!="string"&&typeof n.state.onremove=="function"&&f.call(n.state.onremove,n),n.attrs&&typeof n.attrs.onremove=="function"&&f.call(n.attrs.onremove,n),typeof n.tag!="string")n.instance!=null&&At(n.instance);else{var e=n.children;if(Array.isArray(e))for(var i=0;i<e.length;i++){var c=e[i];c!=null&&At(c)}}}function Fe(n,e,i){n.tag==="input"&&e.type!=null&&n.dom.setAttribute("type",e.type);var c=e!=null&&n.tag==="input"&&e.type==="file";for(var u in e)zt(n,u,null,e[u],i,c)}function zt(n,e,i,c,u,d){if(!(e==="key"||e==="is"||c==null||se(e)||i===c&&!Ve(n,e)&&typeof c!="object"||e==="type"&&n.tag==="input")){if(e[0]==="o"&&e[1]==="n")return le(n,e,c);if(e.slice(0,6)==="xlink:")n.dom.setAttributeNS("http://www.w3.org/1999/xlink",e.slice(6),c);else if(e==="style")ce(n.dom,i,c);else if(oe(n,e,u)){if(e==="value"){if((n.tag==="input"||n.tag==="textarea")&&n.dom.value===""+c&&(d||n.dom===p())||n.tag==="select"&&i!==null&&n.dom.value===""+c||n.tag==="option"&&i!==null&&n.dom.value===""+c)return;if(d&&""+c!=""){console.error("`value` is read-only on file inputs!");return}}n.dom[e]=c}else typeof c=="boolean"?c?n.dom.setAttribute(e,""):n.dom.removeAttribute(e):n.dom.setAttribute(e==="className"?"class":e,c)}}function Ke(n,e,i,c){if(!(e==="key"||e==="is"||i==null||se(e)))if(e[0]==="o"&&e[1]==="n")le(n,e,void 0);else if(e==="style")ce(n.dom,i,null);else if(oe(n,e,c)&&e!=="className"&&e!=="title"&&!(e==="value"&&(n.tag==="option"||n.tag==="select"&&n.dom.selectedIndex===-1&&n.dom===p()))&&!(n.tag==="input"&&e==="type"))n.dom[e]=null;else{var u=e.indexOf(":");u!==-1&&(e=e.slice(u+1)),i!==!1&&n.dom.removeAttribute(e==="className"?"class":e)}}function Ue(n,e){if("value"in e)if(e.value===null)n.dom.selectedIndex!==-1&&(n.dom.value=null);else{var i=""+e.value;(n.dom.value!==i||n.dom.selectedIndex===-1)&&(n.dom.value=i)}"selectedIndex"in e&&zt(n,"selectedIndex",null,e.selectedIndex,void 0)}function qe(n,e,i,c){if(e&&e===i&&console.warn("Don't reuse attrs object, use new object for every redraw, this will throw in next major"),i!=null){n.tag==="input"&&i.type!=null&&n.dom.setAttribute("type",i.type);var u=n.tag==="input"&&i.type==="file";for(var d in i)zt(n,d,e&&e[d],i[d],c,u)}var x;if(e!=null)for(var d in e)(x=e[d])!=null&&(i==null||i[d]==null)&&Ke(n,d,x,c)}function Ve(n,e){return e==="value"||e==="checked"||e==="selectedIndex"||e==="selected"&&n.dom===p()||n.tag==="option"&&n.dom.parentNode===r.activeElement}function se(n){return n==="oninit"||n==="oncreate"||n==="onupdate"||n==="onremove"||n==="onbeforeremove"||n==="onbeforeupdate"}function oe(n,e,i){return i===void 0&&(n.tag.indexOf("-")>-1||n.attrs!=null&&n.attrs.is||e!=="href"&&e!=="list"&&e!=="form"&&e!=="width"&&e!=="height")&&e in n.dom}var Ge=/[A-Z]/g;function We(n){return"-"+n.toLowerCase()}function Pt(n){return n[0]==="-"&&n[1]==="-"?n:n==="cssFloat"?"float":n.replace(Ge,We)}function ce(n,e,i){if(e!==i)if(i==null)n.style.cssText="";else if(typeof i!="object")n.style.cssText=i;else if(e==null||typeof e!="object"){n.style.cssText="";for(var c in i){var u=i[c];u!=null&&n.style.setProperty(Pt(c),String(u))}}else{for(var c in i){var u=i[c];u!=null&&(u=String(u))!==String(e[c])&&n.style.setProperty(Pt(c),u)}for(var c in e)e[c]!=null&&i[c]==null&&n.style.removeProperty(Pt(c))}}function Rt(){this._=a}Rt.prototype=Object.create(null),Rt.prototype.handleEvent=function(n){var e=this["on"+n.type],i;typeof e=="function"?i=e.call(n.currentTarget,n):typeof e.handleEvent=="function"&&e.handleEvent(n),this._&&n.redraw!==!1&&(0,this._)(),i===!1&&(n.preventDefault(),n.stopPropagation())};function le(n,e,i){if(n.events!=null){if(n.events._=a,n.events[e]===i)return;i!=null&&(typeof i=="function"||typeof i=="object")?(n.events[e]==null&&n.dom.addEventListener(e.slice(2),n.events,!1),n.events[e]=i):(n.events[e]!=null&&n.dom.removeEventListener(e.slice(2),n.events,!1),n.events[e]=void 0)}else i!=null&&(typeof i=="function"||typeof i=="object")&&(n.events=new Rt,n.dom.addEventListener(e.slice(2),n.events,!1),n.events[e]=i)}function St(n,e,i){typeof n.oninit=="function"&&f.call(n.oninit,e),typeof n.oncreate=="function"&&i.push(f.bind(n.oncreate,e))}function Bt(n,e,i){typeof n.onupdate=="function"&&i.push(f.bind(n.onupdate,e))}function Ze(n,e){do{if(n.attrs!=null&&typeof n.attrs.onbeforeupdate=="function"){var i=f.call(n.attrs.onbeforeupdate,n,e);if(i!==void 0&&!i)break}if(typeof n.tag!="string"&&typeof n.state.onbeforeupdate=="function"){var i=f.call(n.state.onbeforeupdate,n,e);if(i!==void 0&&!i)break}return!1}while(!1);return n.dom=e.dom,n.domSize=e.domSize,n.instance=e.instance,n.attrs=e.attrs,n.children=e.children,n.text=e.text,!0}var yt;return function(n,e,i){if(!n)throw new TypeError("DOM element being rendered to does not exist.");if(yt!=null&&n.contains(yt))throw new TypeError("Node is currently being rendered to and thus is locked.");var c=a,u=yt,d=[],x=p(),I=n.namespaceURI;yt=n,a=typeof i=="function"?i:void 0;try{n.vnodes==null&&(n.textContent=""),e=rt.normalizeChildren(Array.isArray(e)?e:[e]),M(n,n.vnodes,e,d,null,I==="http://www.w3.org/1999/xhtml"?void 0:I),n.vnodes=e,x!=null&&p()!==x&&typeof x.focus=="function"&&x.focus();for(var y=0;y<d.length;y++)d[y]()}finally{a=c,yt=u}}},de=sr(typeof window!="undefined"?window:null),or=function(t,r,a){var s=[],m=!1,l=-1;function f(){for(l=0;l<s.length;l+=2)try{t(s[l],rt(s[l+1]),p)}catch(g){a.error(g)}l=-1}function p(){m||(m=!0,r(function(){m=!1,f()}))}p.sync=f;function h(g,_){if(_!=null&&_.view==null&&typeof _!="function")throw new TypeError("m.mount expects a component, not a vnode.");var E=s.indexOf(g);E>=0&&(s.splice(E,2),E<=l&&(l-=2),t(g,[])),_!=null&&(s.push(g,_),t(g,rt(_),p))}return{mount:h,redraw:p}},vt=or(de,typeof requestAnimationFrame!="undefined"?requestAnimationFrame:null,typeof console!="undefined"?console:null),ge=function(t){if(Object.prototype.toString.call(t)!=="[object Object]")return"";var r=[];for(var a in t)s(a,t[a]);return r.join("&");function s(m,l){if(Array.isArray(l))for(var f=0;f<l.length;f++)s(m+"["+f+"]",l[f]);else if(Object.prototype.toString.call(l)==="[object Object]")for(var f in l)s(m+"["+f+"]",l[f]);else r.push(encodeURIComponent(m)+(l!=null&&l!==""?"="+encodeURIComponent(l):""))}},ye=Object.assign||function(t,r){for(var a in r)nt.call(r,a)&&(t[a]=r[a])},It=function(t,r){if(/:([^\/\.-]+)(\.{3})?:/.test(t))throw new SyntaxError("Template parameter names must be separated by either a '/', '-', or '.'.");if(r==null)return t;var a=t.indexOf("?"),s=t.indexOf("#"),m=s<0?t.length:s,l=a<0?m:a,f=t.slice(0,l),p={};ye(p,r);var h=f.replace(/:([^\/\.-]+)(\.{3})?/g,function(w,N,M){return delete p[N],r[N]==null?w:M?r[N]:encodeURIComponent(String(r[N]))}),g=h.indexOf("?"),_=h.indexOf("#"),E=_<0?h.length:_,A=g<0?E:g,T=h.slice(0,A);a>=0&&(T+=t.slice(a,m)),g>=0&&(T+=(a<0?"?":"&")+h.slice(g,E));var b=ge(p);return b&&(T+=(a<0&&g<0?"?":"&")+b),s>=0&&(T+=t.slice(s)),_>=0&&(T+=(s<0?"":"&")+h.slice(_)),T},cr=function(t,r,a){var s=0;function m(p){return new r(p)}m.prototype=r.prototype,m.__proto__=r;function l(p){return function(h,g){typeof h!="string"?(g=h,h=h.url):g==null&&(g={});var _=new r(function(b,w){p(It(h,g.params),g,function(N){if(typeof g.type=="function")if(Array.isArray(N))for(var M=0;M<N.length;M++)N[M]=new g.type(N[M]);else N=new g.type(N);b(N)},w)});if(g.background===!0)return _;var E=0;function A(){--E==0&&typeof a=="function"&&a()}return T(_);function T(b){var w=b.then;return b.constructor=m,b.then=function(){E++;var N=w.apply(b,arguments);return N.then(A,function(M){if(A(),E===0)throw M}),T(N)},b}}}function f(p,h){for(var g in p.headers)if(nt.call(p.headers,g)&&g.toLowerCase()===h)return!0;return!1}return{request:l(function(p,h,g,_){var E=h.method!=null?h.method.toUpperCase():"GET",A=h.body,T=(h.serialize==null||h.serialize===JSON.serialize)&&!(A instanceof t.FormData||A instanceof t.URLSearchParams),b=h.responseType||(typeof h.extract=="function"?"":"json"),w=new t.XMLHttpRequest,N=!1,M=!1,q=w,R,C=w.abort;w.abort=function(){N=!0,C.call(this)},w.open(E,p,h.async!==!1,typeof h.user=="string"?h.user:void 0,typeof h.password=="string"?h.password:void 0),T&&A!=null&&!f(h,"content-type")&&w.setRequestHeader("Content-Type","application/json; charset=utf-8"),typeof h.deserialize!="function"&&!f(h,"accept")&&w.setRequestHeader("Accept","application/json, text/*"),h.withCredentials&&(w.withCredentials=h.withCredentials),h.timeout&&(w.timeout=h.timeout),w.responseType=b;for(var D in h.headers)nt.call(h.headers,D)&&w.setRequestHeader(D,h.headers[D]);w.onreadystatechange=function(k){if(!N&&k.target.readyState===4)try{var S=k.target.status>=200&&k.target.status<300||k.target.status===304||/^file:\/\//i.test(p),j=k.target.response,v;if(b==="json"){if(!k.target.responseType&&typeof h.extract!="function")try{j=JSON.parse(k.target.responseText)}catch(X){j=null}}else(!b||b==="text")&&j==null&&(j=k.target.responseText);if(typeof h.extract=="function"?(j=h.extract(k.target,h),S=!0):typeof h.deserialize=="function"&&(j=h.deserialize(j)),S)g(j);else{var V=function(){try{v=k.target.responseText}catch(ft){v=j}var X=new Error(v);X.code=k.target.status,X.response=j,_(X)};w.status===0?setTimeout(function(){M||V()}):V()}}catch(X){_(X)}},w.ontimeout=function(k){M=!0;var S=new Error("Request timed out");S.code=k.target.status,_(S)},typeof h.config=="function"&&(w=h.config(w,h,p)||w,w!==q&&(R=w.abort,w.abort=function(){N=!0,R.call(this)})),A==null?w.send():typeof h.serialize=="function"?w.send(h.serialize(A)):A instanceof t.FormData||A instanceof t.URLSearchParams?w.send(A):w.send(JSON.stringify(A))}),jsonp:l(function(p,h,g,_){var E=h.callbackName||"_mithril_"+Math.round(Math.random()*1e16)+"_"+s++,A=t.document.createElement("script");t[E]=function(T){delete t[E],A.parentNode.removeChild(A),g(T)},A.onerror=function(){delete t[E],A.parentNode.removeChild(A),_(new Error("JSONP request failed"))},A.src=p+(p.indexOf("?")<0?"?":"&")+encodeURIComponent(h.callbackKey||"callback")+"="+encodeURIComponent(E),t.document.documentElement.appendChild(A)})}},we=cr(typeof window!="undefined"?window:null,pe,vt.redraw);function be(t){try{return decodeURIComponent(t)}catch(r){return t}}var xe=function(t){if(t===""||t==null)return{};t.charAt(0)==="?"&&(t=t.slice(1));for(var r=t.split("&"),a={},s={},m=0;m<r.length;m++){var l=r[m].split("="),f=be(l[0]),p=l.length===2?be(l[1]):"";p==="true"?p=!0:p==="false"&&(p=!1);var h=f.split(/\]\[?|\[/),g=s;f.indexOf("[")>-1&&h.pop();for(var _=0;_<h.length;_++){var E=h[_],A=h[_+1],T=A==""||!isNaN(parseInt(A,10));if(E===""){var f=h.slice(0,_).join();a[f]==null&&(a[f]=Array.isArray(g)?g.length:0),E=a[f]++}else if(E==="__proto__")break;if(_===h.length-1)g[E]=p;else{var b=Object.getOwnPropertyDescriptor(g,E);b!=null&&(b=b.value),b==null&&(g[E]=b=T?[]:{}),g=b}}}return s},jt=function(t){var r=t.indexOf("?"),a=t.indexOf("#"),s=a<0?t.length:a,m=r<0?s:r,l=t.slice(0,m).replace(/\/{2,}/g,"/");return l?(l[0]!=="/"&&(l="/"+l),l.length>1&&l[l.length-1]==="/"&&(l=l.slice(0,-1))):l="/",{path:l,params:r<0?{}:xe(t.slice(r+1,s))}},lr=function(t){var r=jt(t),a=Object.keys(r.params),s=[],m=new RegExp("^"+r.path.replace(/:([^\/.-]+)(\.{3}|\.(?!\.)|-)?|[\\^$*+.()|\[\]{}]/g,function(l,f,p){return f==null?"\\"+l:(s.push({k:f,r:p==="..."}),p==="..."?"(.*)":p==="."?"([^/]+)\\.":"([^/]+)"+(p||""))})+"$");return function(l){for(var f=0;f<a.length;f++)if(r.params[a[f]]!==l.params[a[f]])return!1;if(!s.length)return m.test(l.path);var p=m.exec(l.path);if(p==null)return!1;for(var f=0;f<s.length;f++)l.params[s[f].k]=s[f].r?p[f+1]:decodeURIComponent(p[f+1]);return!0}},_e=new RegExp("^(?:key|oninit|oncreate|onbeforeupdate|onupdate|onbeforeremove|onremove)$"),Ee=function(t,r){var a={};if(r!=null)for(var s in t)nt.call(t,s)&&!_e.test(s)&&r.indexOf(s)<0&&(a[s]=t[s]);else for(var s in t)nt.call(t,s)&&!_e.test(s)&&(a[s]=t[s]);return a},Gt={};function fr(t){try{return decodeURIComponent(t)}catch(r){return t}}var ur=function(t,r){var a=t==null?null:typeof t.setImmediate=="function"?t.setImmediate:t.setTimeout,s=pe.resolve(),m=!1,l=!1,f=0,p,h,g=Gt,_,E,A,T,b={onbeforeupdate:function(){return f=f?2:1,!(!f||Gt===g)},onremove:function(){t.removeEventListener("popstate",M,!1),t.removeEventListener("hashchange",N,!1)},view:function(){if(!(!f||Gt===g)){var C=[rt(_,E.key,E)];return g&&(C=g.render(C[0])),C}}},w=R.SKIP={};function N(){m=!1;var C=t.location.hash;R.prefix[0]!=="#"&&(C=t.location.search+C,R.prefix[0]!=="?"&&(C=t.location.pathname+C,C[0]!=="/"&&(C="/"+C)));var D=C.concat().replace(/(?:%[a-f89][a-f0-9])+/gim,fr).slice(R.prefix.length),k=jt(D);ye(k.params,t.history.state);function S(v){console.error(v),q(h,null,{replace:!0})}j(0);function j(v){for(;v<p.length;v++)if(p[v].check(k)){var V=p[v].component,X=p[v].route,ft=V,ot=T=function(et){if(ot===T){if(et===w)return j(v+1);_=et!=null&&(typeof et.view=="function"||typeof et=="function")?et:"div",E=k.params,A=D,T=null,g=V.render?V:null,f===2?r.redraw():(f=2,r.redraw.sync())}};V.view||typeof V=="function"?(V={},ot(ft)):V.onmatch?s.then(function(){return V.onmatch(k.params,D,X)}).then(ot,D===h?null:S):ot("div");return}if(D===h)throw new Error("Could not resolve default route "+h+".");q(h,null,{replace:!0})}}function M(){m||(m=!0,a(N))}function q(C,D,k){if(C=It(C,D),l){M();var S=k?k.state:null,j=k?k.title:null;k&&k.replace?t.history.replaceState(S,j,R.prefix+C):t.history.pushState(S,j,R.prefix+C)}else t.location.href=R.prefix+C}function R(C,D,k){if(!C)throw new TypeError("DOM element being rendered to does not exist.");if(p=Object.keys(k).map(function(j){if(j[0]!=="/")throw new SyntaxError("Routes must start with a '/'.");if(/:([^\/\.-]+)(\.{3})?:/.test(j))throw new SyntaxError("Route parameter names must be separated with either '/', '.', or '-'.");return{route:j,component:k[j],check:lr(j)}}),h=D,D!=null){var S=jt(D);if(!p.some(function(j){return j.check(S)}))throw new ReferenceError("Default route doesn't match any known routes.")}typeof t.history.pushState=="function"?t.addEventListener("popstate",M,!1):R.prefix[0]==="#"&&t.addEventListener("hashchange",N,!1),l=!0,r.mount(C,b),N()}return R.set=function(C,D,k){T!=null&&(k=k||{},k.replace=!0),T=null,q(C,D,k)},R.get=function(){return A},R.prefix="#!",R.Link={view:function(C){var D=kt(C.attrs.selector||"a",Ee(C.attrs,["options","params","selector","onclick"]),C.children),k,S,j;return(D.attrs.disabled=Boolean(D.attrs.disabled))?(D.attrs.href=null,D.attrs["aria-disabled"]="true"):(k=C.attrs.options,S=C.attrs.onclick,j=It(D.attrs.href,C.attrs.params),D.attrs.href=R.prefix+j,D.attrs.onclick=function(v){var V;typeof S=="function"?V=S.call(v.currentTarget,v):S==null||typeof S!="object"||typeof S.handleEvent=="function"&&S.handleEvent(v),V!==!1&&!v.defaultPrevented&&(v.button===0||v.which===0||v.which===1)&&(!v.currentTarget.target||v.currentTarget.target==="_self")&&!v.ctrlKey&&!v.metaKey&&!v.shiftKey&&!v.altKey&&(v.preventDefault(),v.redraw=!1,R.set(j,null,k))}),D}},R.param=function(C){return E&&C!=null?E[C]:E},R},hr=ur(typeof window!="undefined"?window:null,vt),U=function(){return Ct.apply(this,arguments)};U.m=Ct;U.trust=Ct.trust;U.fragment=Ct.fragment;U.Fragment="[";U.mount=vt.mount;U.route=hr;U.render=de;U.redraw=vt.redraw;U.request=we.request;U.jsonp=we.jsonp;U.parseQueryString=xe;U.buildQueryString=ge;U.parsePathname=jt;U.buildPathname=It;U.vnode=rt;U.PromisePolyfill=pt;U.censor=Ee;var mr=U,o=mr;var Wt=class{constructor(r,a,s){z(this,"lat");z(this,"lon");z(this,"timestamp");this.lat=r,this.lon=a,this.timestamp=s}};function Ae(t,r,a,s){var m=6371,l=Nt(a-t),f=Nt(s-r),p=Math.sin(l/2)*Math.sin(l/2)+Math.cos(Nt(t))*Math.cos(Nt(a))*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),g=m*h;return g}function Nt(t){return t*(Math.PI/180)}var it=class{constructor(){z(this,"start_time");z(this,"start_position");z(this,"from");z(this,"stop_time");z(this,"stop_position");z(this,"to");z(this,"distance",0);z(this,"notes","");z(this,"samples",[])}static fromTuple(r){var a=new it;return r.length()==9&&(a.start_time=r[0],a.start_position=r[1],a.from=r[2],a.stop_time=r[3],a.stop_position=r[4],a.to=r[5],a.distance=r[6],a.notes=r[7],a.samples=r[8]),a}toTuple(){return[this.start_time,this.start_position,this.from,this.stop_time,this.stop_position,this.to,this.distance,this.notes,this.samples]}start(r){this.start_time=r}stop(r){this.stop_time=r,this.stop_position=this.samples.length>0?this.samples[this.samples.length-1]:this.start_position}addPosition(r){let a=new Wt(r.coords.latitude,r.coords.longitude,r.timestamp);if(this.samples.length>0){let s=this.samples[this.samples.length-1];this.distance+=Ae(s.lat,s.lon,a.lat,a.lon)}else this.start_position=a;this.samples.push(a)}};var Zt=(t,r)=>r.some(a=>t instanceof a),Te,ke;function pr(){return Te||(Te=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dr(){return ke||(ke=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Yt=new WeakMap,Jt=new WeakMap,Lt=new WeakMap;function gr(t){let r=new Promise((a,s)=>{let m=()=>{t.removeEventListener("success",l),t.removeEventListener("error",f)},l=()=>{a(at(t.result)),m()},f=()=>{s(t.error),m()};t.addEventListener("success",l),t.addEventListener("error",f)});return Lt.set(r,t),r}function yr(t){if(Yt.has(t))return;let r=new Promise((a,s)=>{let m=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",f),t.removeEventListener("abort",f)},l=()=>{a(),m()},f=()=>{s(t.error||new DOMException("AbortError","AbortError")),m()};t.addEventListener("complete",l),t.addEventListener("error",f),t.addEventListener("abort",f)});Yt.set(t,r)}var Qt={get(t,r,a){if(t instanceof IDBTransaction){if(r==="done")return Yt.get(t);if(r==="store")return a.objectStoreNames[1]?void 0:a.objectStore(a.objectStoreNames[0])}return at(t[r])},set(t,r,a){return t[r]=a,!0},has(t,r){return t instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in t}};function Ce(t){Qt=t(Qt)}function wr(t){return dr().includes(t)?function(...r){return t.apply(Xt(this),r),at(this.request)}:function(...r){return at(t.apply(Xt(this),r))}}function br(t){return typeof t=="function"?wr(t):(t instanceof IDBTransaction&&yr(t),Zt(t,pr())?new Proxy(t,Qt):t)}function at(t){if(t instanceof IDBRequest)return gr(t);if(Jt.has(t))return Jt.get(t);let r=br(t);return r!==t&&(Jt.set(t,r),Lt.set(r,t)),r}var Xt=t=>Lt.get(t);function ve(t,r,{blocked:a,upgrade:s,blocking:m,terminated:l}={}){let f=indexedDB.open(t,r),p=at(f);return s&&f.addEventListener("upgradeneeded",h=>{s(at(f.result),h.oldVersion,h.newVersion,at(f.transaction),h)}),a&&f.addEventListener("blocked",h=>a(h.oldVersion,h.newVersion,h)),p.then(h=>{l&&h.addEventListener("close",()=>l()),m&&h.addEventListener("versionchange",g=>m(g.oldVersion,g.newVersion,g))}).catch(()=>{}),p}function Ie(t,{blocked:r}={}){let a=indexedDB.deleteDatabase(t);return r&&a.addEventListener("blocked",s=>r(s.oldVersion,s)),at(a).then(()=>{})}var xr=["get","getKey","getAll","getAllKeys","count"],_r=["put","add","delete","clear"],$t=new Map;function je(t,r){if(!(t instanceof IDBDatabase&&!(r in t)&&typeof r=="string"))return;if($t.get(r))return $t.get(r);let a=r.replace(/FromIndex$/,""),s=r!==a,m=_r.includes(a);if(!(a in(s?IDBIndex:IDBObjectStore).prototype)||!(m||xr.includes(a)))return;let l=async function(f,...p){let h=this.transaction(f,m?"readwrite":"readonly"),g=h.store;return s&&(g=g.index(p.shift())),(await Promise.all([g[a](...p),m&&h.done]))[0]};return $t.set(r,l),l}Ce(t=>({...t,get:(r,a,s)=>je(r,a)||t.get(r,a,s),has:(r,a)=>!!je(r,a)||t.has(r,a)}));var Er=["continue","continuePrimaryKey","advance"],Ne={},te=new WeakMap,Le=new WeakMap,Ar={get(t,r){if(!Er.includes(r))return t[r];let a=Ne[r];return a||(a=Ne[r]=function(...s){te.set(this,Le.get(this)[r](...s))}),a}};async function*Tr(...t){let r=this;if(r instanceof IDBCursor||(r=await r.openCursor(...t)),!r)return;r=r;let a=new Proxy(r,Ar);for(Le.set(a,r),Lt.set(a,Xt(r));r;)yield a,r=await(te.get(a)||r.continue()),te.delete(a)}function De(t,r){return r===Symbol.asyncIterator&&Zt(t,[IDBIndex,IDBObjectStore,IDBCursor])||r==="iterate"&&Zt(t,[IDBIndex,IDBObjectStore])}Ce(t=>({...t,get(r,a,s){return De(r,a)?Tr:t.get(r,a,s)},has(r,a){return De(r,a)||t.has(r,a)}}));var bt=class{constructor(){z(this,"short");z(this,"name");z(this,"company");z(this,"street_adr_1");z(this,"city");z(this,"zip")}};var kr=1,Y,st,ee=class{constructor(){Y.set(this,void 0);st.set(this,void 0);z(this,"tracks",[]);z(this,"addresses",[])}async clearStorage(){O(this,st)&&await Ie(O(this,st))}async initTrackerStorage(r){tt(this,st,r),tt(this,Y,await ve(O(this,st),kr,{upgrade(a,s){switch(s){case 0:{console.log("initializing db"),a.objectStoreNames.contains("tracks")||(console.log("creating tracks store"),a.createObjectStore("tracks",{keyPath:"start_time"})),a.objectStoreNames.contains("adr")||(a.createObjectStore("adr",{keyPath:"short"}),console.log("creating tracks adr"));break}}}})),this.tracks=await this.getTracksOverview(),this.addresses=await this.getAddresses(),console.log(`stored tracks ${this.tracks.length}`),console.log(`stored addresses ${this.addresses.length}`)}async clearTracks(){O(this,st)&&(await O(this,Y).transaction("tracks","readwrite").objectStore("tracks").clear(),this.tracks=[])}async storeTrack(r){let a=O(this,Y).transaction("tracks","readwrite").store;try{await a.add(r),r.samples=[],this.tracks.push(r)}catch(s){if(s.name=="ConstraintError")alert("Track exists already"),console.log("error storing track");else throw console.log("error",s.message),s}}async countTracks(){return await O(this,Y).transaction("tracks","readonly").store.count()}async getTracks(){return await O(this,Y).transaction("tracks","readonly").store.getAll()}async mapTracks(r){let a=[],s=O(this,Y).transaction("tracks","readonly");for await(let m of s.store)a.push(r(m.value));return a}async getTracksOverview(){let r=[],a=O(this,Y).transaction("tracks","readonly");for await(let s of a.store){let m=s.value,l=new it;l.start_time=m.start_time,l.start_position=m.start_position,l.from=m.from,l.stop_time=m.stop_time,l.stop_position=m.stop_position,l.to=m.to,l.distance=m.distance,l.notes=m.notes,r.push(l)}return r}async storeAddress(r){let a=O(this,Y).transaction("adr","readwrite").store;try{await a.add(r),this.addresses.push(r)}catch(s){if(s.name=="ConstraintError")alert("Address exists already");else throw console.log("error",s.message),s}}async delAddressByIndex(r){let a=this.addresses.splice(r,r);await O(this,Y).transaction("adr","readwrite").store.delete(a.short)}async delAddressByShort(r){this.addresses=this.addresses.filter(function(s){return s.short!=r}),await O(this,Y).transaction("adr","readwrite").store.delete(r)}async getAddresses(){let r=[],a=O(this,Y).transaction("adr","readonly");for await(let s of a.store){let m=s.value,l=new bt;l.short=m.short,l.name=m.name,l.company=m.company,l.street_adr_1=m.street_adr_1,l.city=m.city,l.zip=m.zip,r.push(l)}return r}getAddressByShort(r){return this.addresses.find(function(a){return a.short==r})}};Y=new WeakMap,st=new WeakMap;var J=Object.freeze({UNKNOWN:0,ERROR:1,READY:2,TRACKING:3,PAUSED:4,FINISHED:5}),lt,$,xt,Me,dt,ne,re=class{constructor(){xt.add(this);dt.add(this);z(this,"storage",new ee);z(this,"track",new it);lt.set(this,void 0);$.set(this,J.UNKNOWN)}async initTracker(){console.log("initializing tracker ...");let r=this.storage.initTrackerStorage("tlr_tracker");if(!navigator.geolocation)throw new Error("Geolocation is not supported by your browser");await r,console.log("storage initialized"),tt(this,$,J.READY)}getState(){return O(this,$)}isReady(){return O(this,$)>=J.READY}start(){this.track.start_time=Date.now(),ht(this,xt,Me).call(this)}pause(){ht(this,dt,ne).call(this),tt(this,$,J.PAUSED)}resume(){ht(this,xt,Me).call(this),tt(this,$,J.TRACKING)}stop(){this.track.stop(Date.now()),ht(this,dt,ne).call(this),tt(this,$,this.isReady()?J.FINISHED:O(this,$))}cancle(){ht(this,dt,ne).call(this),this.reset()}async save(){this.track.samples.length>0&&await this.storage.storeTrack(this.track),this.reset()}reset(){this.track=new it,tt(this,$,this.isReady()?J.READY:O(this,$))}onNewPosition(r){console.log(`onNewPosition(${r})`),r&&this.track.addPosition(r)}onPositionError(r){throw new Error(r.code)}};lt=new WeakMap,$=new WeakMap,xt=new WeakSet,Me=function(){tt(this,lt,navigator.geolocation.watchPosition(this.onNewPosition.bind(this),this.onPositionError.bind(this),{enableHighAccuracy:!0,timeout:6e4,maximumAge:0})),tt(this,$,J.TRACKING)},dt=new WeakSet,ne=function(){O(this,lt)&&(navigator.geolocation.clearWatch(O(this,lt)),tt(this,lt,null))};var Q={view:({attrs:{type:t,text:r,onclick:a,id:s,disabled:m,left:l}})=>o("button",{id:s,class:"oval-lg",type:t||"button",disabled:m,onclick:a,style:"float: "+(l?"none":"right")},r)};var Cr=["UNBEKANNT","FEHLER","BEREIT","AUFNAHME","PAUSE","FERTIG"];function ze(t){return o(Q,{text:"Abbruch",left:!0,onclick:()=>{t.stop(),t.reset()}})}function Pe(t){return o(Q,{text:"Stop",left:!0,onclick:async()=>{t.stop();let r=document.getElementById("ffrom").value,a=document.getElementById("fto").value;t.track.from=r,t.track.to=a,await t.save()}})}function vr(t){var r;switch(t.getState()){case J.UNKNWON:case J.ERROR:r=o(Q,{text:"Connect",onclick:()=>{t.init()}});break;case J.READY:r=o(Q,{text:"Start",left:!0,onclick:()=>{console.log("start"),t.start()}});break;case J.TRACKING:r=[o(Q,{text:"Pause",left:!0,onclick:()=>{console.log("pause"),t.pause()}}),Pe(t),ze(t)];break;case J.PAUSED:r=[o(Q,{text:"Weiter",left:!0,onclick:()=>{console.log("resume"),t.resume()}}),Pe(t),ze(t)];break}return o(".ctrl",r)}var Ir={view:function(t){return o("datalist",{id:"adr_shorts"},t.attrs.storage.addresses.map(function(r){return o("option",{value:r.short},r.short)}))}},Re={view:t=>{let r=t.attrs.tracker;return console.log("creating tracking view"),o("div.app",o("header",o("h1.gradient-text","Aufnahme")),o("main",o(".card",o(".stat-item",`Status: ${Cr[r.getState()]}`),o(".stat-item",`Distanz: ${r.track.distance}`),o(".stat-item",`Datenpunkte: ${r.track.samples.length}`)),o(Ir,{storage:r.storage}),o(".card",o("form",o("label[for='ffrom']","Von:"),o("input.oval-xlg[id='ffrom'][name='ffrom'][type='text'][list='adr_shorts'][placeholder=Kurz]"),o("label[for='fto']","Nach:"),o("input.oval-xlg[id='fto'][name='fto'][type='text'][list='adr_shorts'][placeholder=Kurz]"))),o(".spaced-container",vr(r))),o("footer","TLR Tools"))}};var Se=(t,r)=>{let a=Math.abs(t-r),s=Math.floor(a/36e5);a-=s*36e5;let m=Math.floor(a/6e4);a-=m*6e4;let l=Math.floor(a/1e3);return`${s}:${("0"+m).slice(-2)}:${("0"+l).slice(-2)}`};function Be(t){let r="";return t.name&&t.name.length>0&&(r+=t.name+","),t.company&&t.company.length>0&&(r+=t.company+","),r+=t.street_adr_1+","+t.zip+" "+t.city,r}async function jr(t,r,a,s){let m=r?";Von":"",l=r?";Nach":"",f=a?";Abfahrt lat;Abfahrt lon":"",p=a?";Ankunft lat;Ankunft lon":"",h=s?";Samples":"",g=["Abfahrt Datum;Abfahrt Zeit"+m+f+";Ankunft Datum;Ankunft Zeit"+l+p+";Strecke [km];Fahrtdauer [h:m:s]"+h],_=0,E=await t.mapTracks(function(b){console.log(`Export track #${_}`),console.log(b),_+=1;let w=[new Date(b.start_time).toLocaleString().replace(",",";")];var N="";if(r){let M=t.getAddressByShort(b.from),q=M?Be(M):"",R=t.getAddressByShort(b.to);N=M?Be(R):"",w.push(q)}return a&&w.push(`${b.start_position.lat.toString()};${b.start_position.lon.toString()}`),w.push(new Date(b.stop_time).toLocaleString().replace(",",";")),r&&w.push(N),a&&w.push(`${b.stop_position.lat.toString()};${b.stop_position.lon.toString()}`),w.push(b.distance>0?(b.distance/1e3).toString():"0"),w.push(Se(b.stop_time,b.start_time)),w.push(b.samples.map(M=>`(${M.lat},${M.lon},${M.timestamp})`).join(",")),w.join(";")});g.push(E.join(`
`)),g=g.join(`
`);let A=new Blob([g],{type:"text/csv;charset=utf-8,"}),T=URL.createObjectURL(A);window.open(T)}var Oe={view:t=>{var r=t.attrs.storage.tracks;let a=r.length>0?r.reduce(function(s,m){return s+m.distance}):0;return o("div.app",o("header",o("h1.gradient-text","Gespeicherte Routen")),o("main",[o(".card",o(".stat-item",`Gesamt km: ${a>0?(a/1e3).toFixed(3):"0.0"}`),o(".stat-item",`Strecken: ${r.length}`)),o(".card",o("table",o("thead",o("tr",o("th","Datum"),o("th","Dauer"),o("th","Distanz [km]"),o("th","Von"),o("th","Nach"))),o("tbody",r.map(function(s){return o("tr",o("th",new Date(s.start_time).toLocaleString()),o("th",Se(s.stop_time,s.start_time)),o("th",(s.distance/1e3).toFixed(2)),o("th",s.from),o("th",s.to))})))),o(".card",o(".spaced-container",o("div",o("label",{for:"export_adr"},"Adressen"),o("input",{id:"export_adr",type:"checkbox"})),o("div",o("label",{for:"export_st_coords"},"Start/Stop Koordinaten"),o("input",{id:"export_st_coords",type:"checkbox"})),o("div",o("label",{for:"export_samples"},"GPS Punkte"),o("input",{id:"export_samples",type:"checkbox"})))),o(".spaced-container",o(Q,{text:"Export",left:!0,onclick:async()=>{console.log("export");let s=document.getElementById("export_adr").checked,m=document.getElementById("export_st_coords").checked,l=document.getElementById("export_samples").checked;await jr(t.attrs.storage,s,m,l)}}),o(Q,{text:"Leeren",left:!0,onclick:async()=>{console.log("clear"),await t.attrs.storage.clearTracks()}}))]),o("footer","TLR Tools"))}};var Nr=o("svg",{class:"icon",viewBox:"0 0 40 40"},o("path",{d:"M19.6 1C28.2 1 35.2 8 35.2 16.6 35.2 20.5 33.7 24.2 31.1 27.1L30.8 27.3 19.6 39 8.4 27.5C2.4 21.3 2.5 11.5 8.7 5.4 11.4 2.8 15 1.2 18.8 1L19.2 1 19.6 1ZM19.6 4.9L19.3 4.9C16.4 5 13.5 6.2 11.4 8.2 6.9 12.7 6.7 19.9 11 24.6L11.2 24.8 19.6 33.4 28 24.7C30 22.6 31.1 20 31.3 17.3L31.3 16.9 31.3 16.6C31.3 10.2 26.2 5 19.9 4.9L19.6 4.9ZM19.6 13.3C21.4 13.3 23 14.8 23 16.7 23 18.6 21.4 20.1 19.6 20.1 17.7 20.1 16.2 18.6 16.2 16.7 16.2 14.8 17.7 13.3 19.6 13.3Z"})),Lr=o("svg",{class:"icon",viewBox:"0 0 24 24"},o("path",{d:"M8 6L21 6.00078M8 12L21 12.0008M8 18L21 18.0007M3 6.5H4V5.5H3V6.5ZM3 12.5H4V11.5H3V12.5ZM3 18.5H4V17.5H3V18.5Z",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})),Dr=o("svg",{class:"icon",viewBox:"0 -32 576 576"},o("path",{d:"M528 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm0 400H48V80h480v352zM208 256c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm-89.6 128h179.2c12.4 0 22.4-8.6 22.4-19.2v-19.2c0-31.8-30.1-57.6-67.2-57.6-10.8 0-18.7 8-44.8 8-26.9 0-33.4-8-44.8-8-37.1 0-67.2 25.8-67.2 57.6v19.2c0 10.6 10 19.2 22.4 19.2zM360 320h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8z"})),Dt={view:function(t){return o("main.layout",[o(".menu",[o(o.route.Link,{href:"/tracker"},Nr),o(o.route.Link,{href:"/tracks"},Lr),o(o.route.Link,{href:"/adr"},Dr)]),o("section",t.children)])}};async function Mr(t){var r=new bt;r.short=document.getElementById("fshort").value,r.name=document.getElementById("fname").value,r.company=document.getElementById("fcompany").value,r.street_adr_1=document.getElementById("fstreet").value,r.city=document.getElementById("fcity").value,r.zip=document.getElementById("fzip").value,await t.storeAddress(r)}function zr(t){var r=document.getElementById("fshort").value,a=document.getElementById("new_adr_save");r?t.addresses.some(function(s){return s.short==r})?(alert("Abkürzung breits vorhanden"),a.disabled=!0):a.disabled&&(a.disabled=!1):(alert("Abkürzung darf nicht leer sein"),a.disabled=!0)}var _n=o("svg",{class:"icon",viewBox:"0 0 256 256"},o("path",{d:"M197.8,10.6c-6.3,1.6-1.6-3-86.9,82.3l-79.2,79.2L20.7,205c-9.3,27.9-10.9,33.2-10.7,34.8c0.4,3.2,3,5.8,6.2,6.2c1.6,0.2,6.9-1.4,34.8-10.7l32.9-10.9l78.3-78.3c43.1-43,79-79.3,79.9-80.5c4.6-6.9,5.1-15.2,1.6-22.8c-1.2-2.6-3-4.6-13.8-15.5c-8-8.1-13.3-13.1-15-14.1C210.1,10.2,203.3,9.2,197.8,10.6z M206.6,25.6c2.5,1.2,23,21.8,24,24.1c0.9,2.2,0.9,4.1,0,6.3c-0.5,1.1-4.4,5.4-11.2,12.2l-10.5,10.5l-15.8-15.8l-15.8-15.8l10.3-10.3c6-6,11-10.7,12.1-11.2C202,24.5,204.2,24.5,206.6,25.6z M182.7,73.6l15.7,15.7l-61,61l-61,61L53,219.1c-12.8,4.2-23.4,7.7-23.6,7.5c-0.1-0.1,3.2-10.7,7.5-23.5l7.7-23.2l61-61c33.5-33.5,61-61,61.2-61C166.9,57.9,174,65,182.7,73.6z"})),Pr=o("svg",{class:"icon",viewBox:"0 0 256 256"},o("path",{fill:"#000000",d:"M95.8,213.8c3.2,0,5.4-2.7,5.4-5.4l-8-128.7c0-3.2-2.7-5.4-5.4-5.4c-3.2,0-5.4,2.7-5.4,5.4l8,128.7C90.5,211.7,93.1,213.8,95.8,213.8z M219.2,42.2h-53.6V20.7c0-5.9-4.8-10.7-10.7-10.7h-53.7c-5.9,0-10.7,4.8-10.7,10.7v21.5H36.8c-3.2,0-5.4,2.1-5.4,5.4c0,3.2,2.1,5.4,5.4,5.4h10.7l10.7,171.6c1.6,11.8,9.7,21.5,21.5,21.5h96.5c11.8,0,19.3-9.7,21.5-21.5l10.7-171.6h10.7c3.2,0,5.4-2.1,5.4-5.4C224.6,44.3,222.4,42.2,219.2,42.2z M101.2,20.7h53.6v21.5h-53.6V20.7z M187,224.5c-0.5,5.9-4.8,10.7-10.7,10.7H79.7c-5.9,0-9.7-4.8-10.7-10.7L58.3,52.9h139.5L187,224.5z M160.2,213.8c3.2,0,5.4-2.1,5.4-5.4l8-128.7c0-3.2-2.1-5.4-5.4-5.4c-3.2,0-5.4,2.1-5.4,5.4l-8,128.7C154.8,211.1,157,213.8,160.2,213.8z M128,213.8c3.2,0,5.4-2.1,5.4-5.4V79.7c0-3.2-2.1-5.4-5.4-5.4c-3.2,0-5.4,2.1-5.4,5.4v128.7C122.6,211.7,124.8,213.8,128,213.8z"}));var He={view:t=>{let r=t.attrs.storage;return o("div.app",o("header",o("h1.gradient-text","Gespeicherte Addressen")),o("main",o(".card",o("form",o("input.oval-xlg[id='fshort'][required][name='fshort'][type='text'][placeholder=Kurz]",{onblur:async a=>{a.redraw=!1,console.log("blur new address"),zr(r)}}),o("br"),o("input.oval-xlg[id='fname'][name='fname'][type='text'][placeholder=Name]"),o("br"),o("input.oval-xlg[id='fcompany'][name='fcompany'][type='text'][placeholder=Firma]"),o("br"),o("input.oval-xlg[id='fstreet'][name='fstreet'][type='text'][placeholder=Fake Street 19]"),o("br"),o("input.oval-xlg[id='fcity'][name='fcity'][type='text'][placeholder=Stuttgart]"),o("br"),o("input.oval-xlg[id='fzip'][name='fzip'][type='text'][placeholder=72304]"),o("br"),o(Q,{text:"Speichern",id:"new_adr_save",left:!0,onclick:async()=>{console.log("save new address"),Mr(r)}}))),r.addresses.map(function(a){return o(".card",o(".spaced-container",o("div",`${a.short}`),o(Q,{text:Pr,left:!0,onclick:async()=>{console.log(`delete address ${a.short}`),await r.delAddressByShort(a.short)}})),o("div",`${a.name}`),o("div",`${a.company}`),o("div",`${a.street_adr_1}`),o("div",`${a.zip} ${a.city}`))}),o(".card",o(Q,{text:"Leeren",left:!0,onclick:async()=>{console.log("clear addresses")}}))),o("footer","TLR Tools"))}};var _t=new re;_t.initTracker().then(o.redraw);var Rr={view:()=>o("h1","Loading...")};o.route(document.body,"/tracker",{"/tracker":{render:function(t){return o(Dt,_t.isReady()?o(Re,{tracker:_t}):o(Rr))}},"/tracks":{render:function(t){return o(Dt,o(Oe,{storage:_t.storage}))}},"/adr":{render:function(t){return o(Dt,o(He,{storage:_t.storage}))}}});
//# sourceMappingURL=index.js.map
